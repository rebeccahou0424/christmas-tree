<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Christmas Tree</title>

  <style>
    /* æ‰‹ç¹ªé¢¨æ ¼SVGæ¿¾é¡ */
    svg.hand-drawn-filter {
      position: absolute;
      width: 0;
      height: 0;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body{
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background:
        radial-gradient(1200px 800px at 50% 25%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(180deg, #0a0e27, #070a1c);
      min-height: 100vh;
      overflow: hidden;
      cursor: crosshair;
      color:#fff;
      -webkit-tap-highlight-color: transparent;
    }

    /* background layer for reliable screenshots (html2canvas) */
    #bg{
      position: fixed;
      inset: 0;
      z-index: 0;
      background:
        radial-gradient(1200px 800px at 50% 25%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(180deg, #0a0e27, #070a1c);
      pointer-events: none;
    }

    #snowCanvas{
      position: fixed;
      inset:0;
      pointer-events:none;
      z-index: 1;
      opacity: .75;
    }

    .main-title{
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      margin: 0;
      font-size: clamp(20px, 5vw, 32px);
      font-weight: bold;
      font-family: 'Georgia', 'Times New Roman', serif;
      color: #fff;
      text-shadow: 
        0 0 20px rgba(255,215,0,0.8),
        0 0 40px rgba(255,215,0,0.5),
        0 2px 4px rgba(0,0,0,0.3);
      z-index: 50;
      user-select: none;
      background: linear-gradient(135deg, #ffd700, #ffed4e, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: titleGlow 2s ease-in-out infinite;
      letter-spacing: 3px;
      padding: 12px 24px;
      border-radius: 16px;
      backdrop-filter: blur(8px);
      border: 2px solid rgba(255, 215, 0, 0.3);
      background-color: rgba(139, 69, 19, 0.15);
    }

    @keyframes titleGlow {
      0%, 100% { 
        filter: brightness(1);
        text-shadow: 
          0 0 20px rgba(255,215,0,0.8),
          0 0 40px rgba(255,215,0,0.5),
          0 2px 4px rgba(0,0,0,0.3);
      }
      50% { 
        filter: brightness(1.2);
        text-shadow: 
          0 0 30px rgba(255,215,0,1),
          0 0 60px rgba(255,215,0,0.7),
          0 2px 4px rgba(0,0,0,0.3);
      }
    }

    .counter{
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,.7);
      font-size: 13px;
      letter-spacing: 2px;
      z-index: 50;
      user-select:none;
      background: rgba(0,0,0,.2);
      padding: 6px 14px;
      border-radius: 22px;
      backdrop-filter: blur(8px);
    }

    .container{
      position: relative;
      width: 100%;
      height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding-bottom: 320px; /* ç‚ºåº•éƒ¨é¢æ¿ç•™ç©ºé–“ */
    }

    .tree-stage{
      position: relative;
      width: min(420px, 85vw);
      aspect-ratio: 520 / 720;
      user-select:none;
      filter: drop-shadow(0 12px 30px rgba(0,0,0,.25));
      z-index: 10;
    }

    .tree-svg{ width:100%; height:100%; display:block; }

    /* lights */
    .light{
      position:absolute;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      pointer-events:none;
      animation: lightPulse 1.5s ease-in-out infinite;
      box-shadow: 0 0 20px currentColor;
      transform: translate(-50%, -50%);
      z-index: 30;
    }
    @keyframes lightPulse{
      0%,100%{ opacity:.6; transform: translate(-50%,-50%) scale(1); }

    /* ===== Screenshot: keep light glow visible in html2canvas ===== */
    body.capturing .light{
      animation: none !important;
      opacity: 1 !important;
      transform: translate(-50%,-50%) scale(1.25) !important;
      box-shadow: 0 0 28px currentColor, 0 0 60px currentColor !important;
      filter: blur(0.25px);
    }
      50%{ opacity:1; transform: translate(-50%,-50%) scale(1.25); }
    }

    /* decor */
    .decor{
      position:absolute;
      width: 32px;
      height: 32px;
      transform: translate(-50%,-50%);
      pointer-events:none;
      z-index: 35;
      filter: drop-shadow(0 6px 12px rgba(0,0,0,.2));
    }

    /* wish */
    .wish{
      position:absolute;
      left: 50%;
      top: 46%;
      transform: translateX(-50%);
      color:#fff;
      font-size: 15px;
      font-weight:300;
      letter-spacing:2px;
      pointer-events:none;
      white-space:nowrap;
      text-shadow: 0 0 10px rgba(255,255,255,.5);
      animation: wishFloat 4s ease-out forwards;
      z-index: 80;
    }
    @keyframes wishFloat{
      0%{ opacity:0; transform: translateX(-50%) translateY(0) scale(.5); }
      20%{ opacity:1; transform: translateX(-50%) translateY(-18px) scale(1); }
      80%{ opacity:1; }
      100%{ opacity:0; transform: translateX(-50%) translateY(-150px) scale(.85); }
    }

    /* sparks */
    .spark{
      position:absolute;
      width: 4px;
      height: 4px;
      background:#fff;
      border-radius:50%;
      pointer-events:none;
      animation: sparkle 1s ease-out forwards;
      z-index: 120;
    }
    @keyframes sparkle{
      0%{ opacity:1; transform: translate(0,0) scale(1); }
      100%{ opacity:0; transform: translate(var(--tx), var(--ty)) scale(0); }
    }

    /* instruction */
    .instruction{
      position: fixed;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,.5);
      font-size: 11px;
      font-weight:300;
      letter-spacing: 1.5px;
      text-align:center;
      line-height: 1.5;
      animation: fadeInOut 3s ease-in-out infinite;
      pointer-events:none;
      z-index: 60;
      user-select:none;
      max-width: 90%;
    }
    @keyframes fadeInOut{
      0%,100%{ opacity:.3; }
      50%{ opacity:.65; }
    }

    /* controls */
    .controls{
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(10,14,39,.85);
      backdrop-filter: blur(12px);
      border-top: 1px solid rgba(255,255,255,.1);
      padding: 10px 12px 12px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 320px;

      /* smooth expand/collapse */
      transition: max-height .25s ease, transform .25s ease, padding .25s ease;
      touch-action: pan-y;
    }
    .controls.collapsed{
      max-height: 76px;
      padding: 8px 12px 10px;
    }
    .controls.collapsed #options{ display:none; }

    .panel-handle{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      user-select:none;
      -webkit-user-select:none;
      cursor: pointer;
      padding: 6px 0 0;
    }
    .grabber{
      width: 44px;
      height: 5px;
      border-radius: 999px;
      background: rgba(255,255,255,.24);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.10);
    }
    .panel-toggle{
      width: 32px;
      height: 28px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.85);
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .panel-toggle svg{ width: 18px; height: 18px; display:block; }
    .controls.collapsed .panel-toggle svg{ transform: rotate(180deg); }

    .control-buttons{
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .control-btn{
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: rgba(255,255,255,.12);
      border: 2px solid rgba(255,255,255,.25);
      color:#fff;
      font-size: 20px;
      cursor:pointer;
      display:grid;
      place-items:center;
      transition: .2s ease;
      flex-shrink: 0;
      position: relative;
      box-shadow: 
        0 2px 8px rgba(0,0,0,.15),
        inset 0 1px 0 rgba(255,255,255,.1);
    }
    .control-btn svg{
      width: 22px;
      height: 22px;
      display:block;
      opacity: .92;
    }

    
    .control-btn:active{ 
      background: rgba(255,255,255,.2); 
      transform: scale(.92); 
    }

    /* options panel */
    .options{
      width: 100%;
      overflow-y: auto;
      max-height: 200px;
      padding-right: 4px;
      -webkit-overflow-scrolling: touch;
    }

    .options::-webkit-scrollbar {
      width: 4px;
    }
    .options::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 2px;
    }
    .options::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,.2);
      border-radius: 2px;
    }

    .opt-section{
      margin-bottom: 14px;
    }

    .opt-title{
      font-size: 11px;
      letter-spacing: 1.5px;
      opacity: .65;
      margin-bottom: 8px;
      user-select:none;
      text-transform: uppercase;
    }

    .opt-row{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content: center; /* âœ… è£é£¾å“åƒæ¨¹æ¢¢ä¸€æ¨£ç½®ä¸­ */
    }

    .chip{
      padding: 8px 12px;
      border-radius: 22px;
      border: 1.5px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.08);
      cursor:pointer;
      font-size: 12px;
      letter-spacing: 0.8px;
      user-select:none;
      transition: .2s ease;
      white-space: nowrap;
      flex-shrink: 0;
      position: relative;
      box-shadow: 
        0 1px 4px rgba(0,0,0,.1),
        inset 0 1px 0 rgba(255,255,255,.05);
    }
    
    .chip.active{
      background: rgba(255,255,255,.25);
      border-color: rgba(255,215,0,.4);
      box-shadow: 
        0 0 12px rgba(255,215,0,.15),
        0 1px 4px rgba(0,0,0,.15),
        inset 0 1px 0 rgba(255,255,255,.1);
    }
    .chip:active{
      transform: scale(.95);
    }

    
/* ===== Icon chips (show SVG instead of text) ===== */
.chip.icon{
  padding: 0;
  width: 108px;   /* âœ… æ•´é«”å†æ”¾å¤§ä¸€é» */
  height: 108px;
  border-radius: 22px;
  display: grid;
  place-items: center;

  /* æ‹¿æ‰å¤–æ¡†/åº•è‰²ï¼šåªç•™åœ–æ¡ˆ */
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  overflow: visible; /* prevent clipping when child SVG is scaled */
}
.chip.icon .thumb{
  width: 92px;
  height: 92px;
  display: grid;
  place-items: center;
}
  overflow: visible; /* allow scaled SVG to extend without clipping */

.thumb svg, .thumb img{ pointer-events:none; }
.chip.icon .thumb svg{
  width: 92px;
  height: 92px;
  display: block;
}
.chip.icon .thumb .emoji{
  font-size: 54px;
  line-height: 1;
}

/* è®“ã€Œæ¨¹æ¢¢/æ˜Ÿæ˜Ÿã€è·Ÿã€Œè£é£¾å“ã€çš„è¦–è¦ºå°ºå¯¸ä¸€è‡´ï¼š
   ç”±æ–¼æ˜Ÿæ˜Ÿ SVG çš„ viewBox ç•™ç™½è¼ƒå¤šï¼Œç›´æ¥æ”¾å¤§ SVG å…§å®¹æœƒæ›´æ¥è¿‘è£é£¾å“å¤§å° */
/* é è¨­ï¼šä¸è¦é¡å¤–æ”¾å¤§ï¼ˆçµ¦è´è¶çµ/å¤©ä½¿ç”¨ï¼‰ */
#starRow .chip.icon .thumb svg{
  transform: none;
  transform-origin: 50% 50%;
}
/* åªæœ‰ã€Œæ˜Ÿæ˜Ÿã€åˆ†é¡æ‰éœ€è¦æ”¾å¤§ï¼Œå› ç‚ºæ˜Ÿæ˜Ÿ SVG çš„ viewBox ç•™ç™½è¼ƒå¤š */
#starRow[data-toptype="star"] .chip.icon{
  width: 122px;
  height: 122px;
  overflow: hidden; /* âœ… é¿å…æ”¾å¤§å¾Œçš„æ˜Ÿæ˜Ÿè·‘åˆ°éš”å£ï¼Œé»åˆ°æœƒé¸åˆ°ä¸‹ä¸€å€‹ */
  border-radius: 24px;
}
#starRow[data-toptype="star"] .chip.icon .thumb{
  width: 116px;
  height: 116px;
}
#starRow[data-toptype="star"] .chip.icon .thumb svg{
  width: 116px;
  height: 116px;
  transform: scale(1.35);
  transform-origin: 50% 50%;
}
/* åªæœ‰ã€Œå…¶ä»–/å¤©ä½¿ã€åˆ†é¡ï¼šå¤©ä½¿åœ¨é¸é …ç¸®åœ–åå°ï¼Œå–®ç¨æ”¾å¤§ */
#starRow[data-toptype="holiday"] .chip.icon{
  width: 120px;
  height: 120px;
}
#starRow[data-toptype="holiday"] .chip.icon .thumb{
  width: 112px;
  height: 112px;
}
#starRow[data-toptype="holiday"] .chip.icon .thumb svg{
  width: 112px;
  height: 112px;
  transform: none;
}
#starRow[data-toptype="holiday"] .chip.icon,
#starRow[data-toptype="holiday"] .chip.icon .thumb{
  overflow: visible;
}
/* è¢«é¸åˆ°æ™‚ç”¨å…‰æšˆæç¤ºï¼Œä¸ç”¨å¤–æ¡† */
.chip.icon.active{
  filter: drop-shadow(0 0 8px rgba(255, 214, 102, .8));
  transform: scale(1.05);
}
/* signature */
    .signature{
      position: fixed;
      left: 50%;
      bottom: 310px;
      transform: translateX(-50%);
      z-index: 850;
      pointer-events:all;
      color: rgba(255,255,255,.65);
      font-size: 11px;
      letter-spacing: 1.2px;
      text-shadow: 0 0 10px rgba(255,255,255,.15);
      display:inline-flex;
      flex-direction: column;
      gap: 4px;
      align-items:center;
      user-select:none;
    }
    .sig-pill{
      padding: 6px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.2);
      background: rgba(10,14,39,.6);
      backdrop-filter: blur(8px);
    }
    .sig-hint{ 
      opacity:.6; 
      font-size: 10px; 
      letter-spacing: 0.8px; 
    }


/* ===== Tree Top icons: bigger + no outer frame ===== */






/* Tree Top tabs a bit larger (icon + underline) */
.star-section .top-tabs .tab{
  font-size: 18px;
  padding: 6px 4px;
  opacity: .65;
}
.star-section .top-tabs .tab.active{
  opacity: 1;
}
    /* screenshot flash */
    .capture-flash{
      position: fixed;
      inset:0;
      background:#fff;
      opacity:0;
      pointer-events:none;
      z-index: 9999;
    }
    .capture-flash.active{ animation: flashEffect .5s ease-out; }
    @keyframes flashEffect{
      0%{ opacity:0; }
      50%{ opacity:.45; }
      100%{ opacity:0; }
    }

    .download-notification{
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,.95);
      color: #0a0e27;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 12px;
      letter-spacing: 1.5px;
      opacity: 0;
      pointer-events:none;
      z-index: 10000;
      box-shadow: 0 10px 40px rgba(0,0,0,.3);
    }
    .download-notification.show{ animation: notificationShow 2s ease-in-out; }
    @keyframes notificationShow{
      0%{ opacity:0; transform: translate(-50%,-50%) scale(.88); }
      20%{ opacity:1; transform: translate(-50%,-50%) scale(1); }
      80%{ opacity:1; }
      100%{ opacity:0; transform: translate(-50%,-50%) scale(.88); }
    }

    /* Desktop adjustments */
    @media (min-width: 769px){
      .container{
        padding-bottom: 0;
      }

      .controls{
        position: fixed;
        bottom: 18px;
        left: 18px;
        right: auto;
        width: min(420px, calc(100vw - 36px));
        background: rgba(255,255,255,.10);
        border: 1px solid rgba(255,255,255,.16);
        backdrop-filter: blur(12px);
        border-radius: 18px;
        padding: 14px;
        max-height: none;
      }

      .control-buttons{
        position: fixed;
        bottom: 18px;
        right: 18px;
        flex-direction: row;
      }

      .control-btn{
        width: 50px;
        height: 50px;
      }

      .signature{
        position: fixed;
        right: 18px;
        bottom: 86px;
        left: auto;
        transform: none;
        flex-direction: row;
        gap: 10px;
      }

      .instruction{
        bottom: 96px;
        top: auto;
        font-size: 13px;
      }

      .counter{
        top: 18px;
        font-size: 12px;
      }

      .options{
        max-height: none;
      }
    }

/* ===== Decor Tabs (clear hierarchy) ===== */
.decor-tabs{
  display:flex;
  gap: 8px;
  padding: 4px 2px 10px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;

  /* è®“ Tabs çœ‹èµ·ä¾†åƒä¸€æ¢å·¥å…·åˆ— */
  border-bottom: 1px solid rgba(255,255,255,.10);
}

.decor-tabs::-webkit-scrollbar{ height: 4px; }
.decor-tabs::-webkit-scrollbar-track{ background: rgba(255,255,255,.05); border-radius: 2px; }
.decor-tabs::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.20); border-radius: 2px; }

/* Tabsï¼šä¸è¦è† å›Šã€ä¸è¦åšæé‚Š -> è®Šæˆã€Œæ–‡å­— + åº•ç·šã€ */
.decor-tab{
  appearance: none;
  border: none;
  background: transparent;
  color: rgba(255,255,255,.55);
  font-size: 12px;
  font-weight: 800;
  letter-spacing: 1.2px;
  padding: 10px 6px 12px;
  cursor: pointer;
  user-select: none;
  position: relative;
  white-space: nowrap;
  opacity: .75;
  transition: .2s ease;
}

.decor-tab:hover{ color: rgba(255,255,255,.80); }
.decor-tab:active{ transform: translateY(1px); }

/* Activeï¼šåº•ç·šé«˜äº® + å­—æ›´äº® */
.decor-tab.active{
  color: #fff;
  opacity: 1;
}

.decor-tab.active::after{
  content:"";
  position:absolute;
  left: 6px;
  right: 6px;
  bottom: -1px;
  height: 3px;
  border-radius: 3px;
  background: rgba(255, 215, 0, .85);
  box-shadow: 0 0 14px rgba(255,215,0,.25);
}

/* å¯é¸ï¼šTab å°åœ–ç¤ºæ›´æ·¡ä¸€é» */
.decor-tab .ico{
  margin-right: 6px;
  opacity: .8;
}

/* ===== Tabs (Tree top) ===== */
.tabs{
  display:flex;
  gap: 14px;
  align-items:center;
  padding: 6px 2px 10px;
  overflow-x:auto;
  -webkit-overflow-scrolling: touch;
}

.tab{
  position: relative;
  padding: 6px 2px;
  font-size: 12px;
  letter-spacing: 1.2px;
  opacity: .55;
  cursor: pointer;
  user-select:none;
  white-space: nowrap;
}

.tab.active{
  opacity: .95;
}

.tab.active::after{
  content:"";
  position:absolute;
  left:0;
  right:0;
  bottom:-6px;
  height:3px;
  border-radius: 999px;
  background: rgba(255,215,0,.85);
  box-shadow: 0 0 12px rgba(255,215,0,.25);
}

/* =========================
   TREE TOP ICONS (BIG)
========================= */

.top-icons {
  display: flex;
  gap: 14px;
  padding: 4px 2px 8px;
  align-items: center;

  /* âœ… è®“æ¨¹æ¢¢ç¬¬äºŒæ’å¯ä»¥è‡ªå‹•æ›è¡Œï¼Œä¸å†åªèƒ½å¾€å³æ»‘ */
  flex-wrap: wrap;
  justify-content: center;
  row-gap: 8px;
  overflow-x: hidden;
}

.top-icon {
  width: 70px;          /* ğŸ”¥ é—œéµï¼šè®Šå¤§ */
  height: 70px;
  cursor: pointer;
  display: grid;
  place-items: center;
  transition: .2s ease;
  opacity: .7;
}

.top-icon svg {
  width: 100%;
  height: 100%;
}

/* Active ç‹€æ…‹ */
.top-icon.active {
  opacity: 1;
  transform: scale(1.15);
  filter: drop-shadow(0 0 10px rgba(255,215,0,.45));
  position: relative;
}

.top-icon.active::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 20px;
  height: 3px;
  border-radius: 3px;
  background: rgba(255,215,0,.9);
}

/* ===== Layout: 4 items per row for Decoration + Tree Top options ===== */
#decorRow, #starRow{
  display: grid !important;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 10px 10px;
  align-items: center;
  justify-items: center;
  width: 100%;
}

/* Tree Top category tabs align left like Decoration tabs */
#topTypeRow.tabs{
  justify-content: flex-start;
}

  </style>
</head>

<body>
  <!-- æ‰‹ç¹ªé¢¨æ ¼æ¿¾é¡ -->
  <svg class="hand-drawn-filter">
    <defs>
    <filter id="softBlur">
        <feGaussianBlur stdDeviation="0.8" />
    </filter>
    </defs>
  </svg>
  
  <div id="bg"></div>

  <canvas id="snowCanvas"></canvas>

  <div class="counter" id="counter">LIGHTS: 0</div>

  <div class="container">
    <div class="tree-stage" id="treeStage"></div>
  </div>

  <div class="instruction">
    é»æ¨¹ä¸Šä»»æ„è™•æ”¾ç½®è£é£¾å“åŠé¸æ“‡æ¨¹æ¢¢<br>
  </div>

  <div class="controls">
    
    <div class="panel-handle" id="panelHandle" aria-label="Toggle panel">
      <div class="grabber"></div>
      <button class="panel-toggle" id="panelToggle" type="button" aria-label="Toggle">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
<div class="control-buttons">
      <button class="control-btn" id="musicBtn" title="éŸ³æ¨‚é–‹é—œ"><svg viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M9 18V6l12-2v12"/><path fill="currentColor" d="M7.5 20.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/><path fill="currentColor" d="M19.5 18.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/></svg></button>
      <button class="control-btn" id="captureBtn" title="æˆªåœ–åˆ†äº«"><svg viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" d="M4 7h4l2-2h4l2 2h4v13H4z"/><circle cx="12" cy="14" r="3" fill="none" stroke="currentColor" stroke-width="2"/></svg></button>
      <button class="control-btn" id="signBtn" title="è¨­å®šç½²å"><svg viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 20h9"/><path fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" d="M16.5 3.5l4 4L8 20l-4 1 1-4z"/></svg></button>
      <button class="control-btn" id="clearBtn" title="æ¸…ç©º"><svg viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M4 7h16"/><path fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" d="M10 3h4l1 2H9z"/><path fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" d="M6 7l1 14h10l1-14"/><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" d="M10 11v6M14 11v6"/></svg></button>
    </div>

    <div class="options" id="options">
      <div class="opt-section">
  <div class="opt-title">Decoration è£é£¾å“</div>
  <div class="decor-tabs" id="decorTabs"></div>
  <div class="opt-row" id="decorRow"></div>
</div>

<div class="opt-section star-section">
  <div class="opt-title">Tree Top æ¨¹æ¢¢</div>

  <!-- ç¬¬ä¸€æ’ï¼šåˆ†é¡ icon -->
  <div class="top-icons" id="topTypeRow"></div>

  <!-- ç¬¬äºŒæ’ï¼šå¯¦éš›æ¬¾å¼ -->
  <div class="top-icons" id="starRow"></div>
</div>
    </div>
  </div>

  <div class="signature" id="signature">
    <div class="sig-pill" id="sigText">Merry Christmas!!!</div>
    <div class="sig-hint" id="sigDate"></div>
  </div>

  <div class="capture-flash" id="flash"></div>
  <div class="download-notification" id="notification">åœ–ç‰‡å·²æº–å‚™å¥½ä¸‹è¼‰ âœ“</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    /* =========================
       DATA
    ========================= */
    const wishes = ['MERRY CHRISTMAS','PEACE','JOY','LOVE','HOPE','DREAM','SMILE','MAGIC','WONDER','BELIEVE'];

    const lightColors = ['#ff6b6b','#ffd93d','#6bcf7f','#4d96ff','#c77dff','#ff8fab','#7dd3fc','#fca5a5','#a7f3d0','#fde68a'];
    //const STAR_T = `translate(260 112) scale(1.28)`;  // â­ æ›´å¤§ + ç¨å¾®å¾€ä¸Š

const STARS = [
  { id:'waterGold', name:'â­ Water Gold', svg: starSVG_WaterGold() },
  { id:'waterPink', name:'â­ Water Pink', svg: starSVG_WaterPink() },
  { id:'peppermint', name:'â­ Peppermint', svg: starSVG_Peppermint() },
  { id:'north', name:'â­ North', svg: starSVG_North() },
  { id:'snowflake', name:'â­ Snowflake', svg: starSVG_Snowflake() },
  { id:'gold3d', name:'â­ 3D Gold', svg: starSVG_3DGoldBig() },
  { id:'glow', name:'â­ Glow', svg: starSVG_Glow() },

  { id:'waterBlue', name:'â­ Water Blue', svg: starSVG_WaterBlue() },
  { id:'waterMint', name:'â­ Water Mint', svg: starSVG_WaterMint() },
  { id:'waterSilver', name:'â­ Water Silver', svg: starSVG_WaterSilver() },

  { id:'bowRibbon', name:'ğŸ€ Ribbon Glossy', svg: bowSVG_RibbonGlossy() },
  { id:'bowVelvet', name:'ğŸ€ Velvet Long',   svg: bowSVG_VelvetLong() },
  { id:'bowSheer',  name:'ğŸ€ Sheer',         svg: bowSVG_Sheer() },
  { id:'bowWaterYellow', name:'ğŸ€ Water Yellow',   svg: bowSVG_WaterYellow() },
  { id:'bowWaterGreen',  name:'ğŸ€ Water Green',    svg: bowSVG_WaterGreen() },
  { id:'bowWaterRed',    name:'ğŸ€ Water Red',      svg: bowSVG_WaterRed() },
  // ğŸ‘¼ï¼ˆåŸæœ¬èª¤æ”¾åœ¨è´è¶çµç¬¬ 4 å€‹çš„ã€ŒCandyã€å¤©ä½¿ï¼‰
  // é€™è£¡ç”¨ angelSVG_Candy() åŒ…æˆæ¨™æº–åº§æ¨™ç³»ï¼Œé¿å…åœ¨é¸é …åˆ—/æ¨¹æ¢¢ä½ç½®è·‘æ‰
  { id:'angel',    name:'ğŸ‘¼ Angel',        svg: angelSVG_Candy() },
  { id:'angelGold', name:'ğŸ‘¼ Angel Gold',  svg: angelSVG_SimpleGold() },
  { id:'angelBlue', name:'ğŸ‘¼ Angel Blue',  svg: angelSVG_SimpleBlue() },
  { id:'xmasHolly', name:'ğŸ„ Holly',      svg: xmasSVG_Holly() },
  { id:'xmasBell',  name:'ğŸ”” Bell',       svg: xmasSVG_Bell() },
  { id:'xmasHat',   name:'ğŸ… Santa Hat',  svg: xmasSVG_SantaHat() },
  { id:'xmasCandy', name:'ğŸ­ Candy Cane', svg: xmasSVG_CandyCane() },
  { id:'xmasGift',  name:'ğŸ Gift',       svg: xmasSVG_Gift() },

  { id:'bowLine',   name:'ğŸ€ Line Art',      svg: bowSVG_LineArt() },

  // âœ… åªä¿ç•™ä¸€å€‹å¤©ä½¿ï¼ˆä¸Šé¢é€™å€‹ï¼‰ï¼Œé¿å…é‡è¤‡

  { id:'none', name:'None', svg:'' },
];
    function getTopTypeByStarId(id){
  if(id === 'none') return 'none';
  if(id.startsWith('bow')) return 'bow';
  // å…¶ä»–è–èª•æ¨¹æ¢¢å…ƒç´ ï¼ˆå«å¤©ä½¿ï¼‰
  if(id.startsWith('angel') || id.startsWith('xmas')) return 'holiday';
  return 'star';
}

function getStarsByTopType(type){
  if(type === 'none') return STARS.filter(s => s.id === 'none');
  return STARS.filter(s => getTopTypeByStarId(s.id) === type);
}
    const DECORS = [
      { id:'light',   name:'ğŸ’¡ è®Šè‰²ç‡ˆé£¾',   svg: decor_lightIcon() }, // ç‰¹æ®Šæ¨™è¨˜
      
      // è´è¶çµç³»åˆ— (8æ¬¾)
// è´è¶çµç³»åˆ—ï¼ˆæ›´å¤šæ¬¾ï¼‰
{ id:'bowCreamStripe', name:'è´è¶çµï¼šå¥¶æ²¹æ¢ç´‹', svg: decor_bowCreamStripe() },
{ id:'bowGreenDots',   name:'è´è¶çµï¼šç¶ é»é»',   svg: decor_bowGreenDots() },
{ id:'bowBurgundy',    name:'è´è¶çµï¼šé…’ç´…èŠ±ç´‹', svg: decor_bowBurgundyFloral() },
{ id:'bowRedBig',      name:'è´è¶çµï¼šå¤§ç´…',     svg: decor_bowRedBig() },
{ id:'bowBlueSoft',    name:'è´è¶çµï¼šéœ§è—',     svg: decor_bowBlueSoft() },
{ id:'bowPinkRibbon',  name:'è´è¶çµï¼šç²‰ç·å¸¶',   svg: decor_bowPinkRibbon() },
{ id:'bowYellow', name:'è´è¶çµï¼šé»ƒè‰²', svg: decor_bowYellow() },
{ id:'bowTinyRed',     name:'è´è¶çµï¼šå°å°ç´…',   svg: decor_bowTinyRed() },
      
      // è¥ªå­ç³»åˆ— (6æ¬¾)
        {
        id:'sockSnow', name:'é›ªèŠ±è¥ª', svg: decor_sock_snow()
        },
        {
        id:'sockStripe', name:'æ¢ç´‹è¥ª', svg: decor_sock_stripe()
        },
        {
        id:'sockDots', name:'åœ“é»è¥ª', svg: decor_sock_dots()
        },
        {
        id:'sockTree', name:'è–èª•æ¨¹è¥ª', svg: decor_sock_tree()
        },
        {
        id:'sockFuzzy', name:'æ¯›è¥ª', svg: decor_sock_fuzzy()
        },
        {
        id:'sockWinter', name:'å†¬å­£è¥ª', svg: decor_sock_winter()
        },
      
      // è–èª•çƒç³»åˆ—
      { id:'ball',    name:'ğŸ”´ ç´…çƒ',   svg: decor_ball() },
      { id:'ball2',   name:'ğŸ”µ è—çƒ',   svg: decor_ball2() },
      { id:'ballGold',name:'ğŸŸ¡ é‡‘çƒ',   svg: decor_ballGold() },
      { id:'ballPurple',name:'ğŸŸ£ ç´«çƒ', svg: decor_ballPurple() },
      
      // å…¶ä»–ç¶“å…¸å…ƒç´ 
      { id:'candy',   name:'ğŸ­ æ‹æ–ç³–', svg: decor_candy() },
      { id:'ginger',  name:'ğŸª è–‘é¤…äºº', svg: decor_gingerbread() },
      { id:'bell',    name:'ğŸ”” éˆ´éº',   svg: decor_bell() },
      { id:'gift',    name:'ğŸ ç¦®ç‰©',   svg: decor_gift() },
      { id:'gift2',   name:'ğŸ ç¦®ç‰©2',  svg: decor_gift2() },
      { id:'candle',  name:'ğŸ•¯ï¸ è Ÿç‡­',   svg: decor_candle() },
      { id:'snow',    name:'â„ï¸ é›ªèŠ±',   svg: decor_snow() },
      { id:'starMini',name:'â­ å°æ˜Ÿæ˜Ÿ', svg: decor_starMini() },
      { id:'heart',   name:'â¤ï¸ æ„›å¿ƒ',   svg: decor_heart() },
      { id:'holly',   name:'ğŸŒ¿ å†¬é’',   svg: decor_holly() },
    ];

    /* =========================
       STATE
    ========================= */
const TOP_TYPES = [
  { id:'star',  name:'â­ æ˜Ÿæ˜Ÿ' },
  { id:'bow',   name:'ğŸ€ è´è¶çµ' },
  { id:'holiday', name:'ğŸ„ å…¶ä»–' },
  { id:'none',  name:'ğŸš« ç„¡' }
];

let state = {
  topType: 'star',          // âœ… æ–°å¢ï¼šæ¨¹æ¢¢åˆ†é¡
  starId: STARS[0].id,      // âœ… ä»æ²¿ç”¨ï¼šæ¨¹æ¢¢æ¬¾å¼ id
  decorId: 'light',
  lightCount: 0,
  placeCount: 0
};
const ornaments = [];
    const counter = document.getElementById('counter');

    function renderTree(){
      const star = STARS.find(s => s.id === state.starId);
      
      // ä¿å­˜ç¾æœ‰çš„ç‡ˆé£¾å’Œé…é£¾
      const existingLights = Array.from(treeStage.querySelectorAll('.light'));
      const existingDecors = Array.from(treeStage.querySelectorAll('.decor'));

      treeStage.innerHTML = `
        <svg class="tree-svg" viewBox="0 0 520 720" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs>
            <filter id="rough">
              <feTurbulence type="fractalNoise" baseFrequency=".012" numOctaves="2" seed="2"/>
              <feDisplacementMap in="SourceGraphic" scale="6"/>
            </filter>
          </defs>

          <g filter="url(#rough)">
            ${realisticTree()}
          </g>

            ${star.id === 'none' ? '' : `
            <g filter="url(#rough)">
                ${
                (() => {
                  const ORIG_X = 260, ORIG_Y = 120;      // star/angel SVGs are built around this anchor
                  const TOP_Y_BOW   = 130;               // ğŸ€ bow baseline (keep)
                  const TOP_Y_ANGEL = 138;               // ğŸ‘¼ angel baseline (keep)
                  const TOP_Y_STAR  = 154;               // â­ star a bit lower

                  const scaleStar  = 0.85;              // âœ… smaller
                  const scaleAngel = 0.85;              // âœ… smaller
                  const scaleBow   = 1.35;              // âœ… smaller than before (was 1.75)

                  if (star.id.startsWith('bow')) {
                    // bow SVG is drawn around (0,0), so just place it directly
                    return `<g transform="translate(${ORIG_X} ${TOP_Y_BOW}) scale(${scaleBow})">${star.svg}</g>`;
                  }

                  // star / angel SVGs already have a <g transform="translate(260 120)"> inside,
                  // so we re-anchor + scale around (260,120) and then nudge downward.
                  const isAngel = star.id.startsWith('angel');
                  const s = isAngel ? scaleAngel : scaleStar;
                  const y = isAngel ? TOP_Y_ANGEL : TOP_Y_STAR;

                  return `<g transform="translate(${ORIG_X} ${y}) scale(${s}) translate(${-ORIG_X} ${-ORIG_Y})">${star.svg}</g>`;
                })()
                }
            </g>
            `}
        </svg>
      `;
      
      // é‡æ–°æ·»åŠ ä¿å­˜çš„ç‡ˆé£¾å’Œé…é£¾
      existingLights.forEach(light => treeStage.appendChild(light));
      existingDecors.forEach(decor => treeStage.appendChild(decor));
    }

    function clearAll(){
      treeStage.querySelectorAll('.light,.decor').forEach(n => n.remove());
      state.lightCount = 0;
      state.placeCount = 0;
      counter.textContent = 'LIGHTS: 0';
    }

    function setActive(rowEl, key, value){
      rowEl.querySelectorAll('.chip').forEach(ch => {
        ch.classList.toggle('active', ch.dataset[key] === value);
      });
    }

    /* =========================
       BUILD UI
    ========================= */
/* =========================
   BUILD UI (Decor Tabs + TreeTop Tabs)
========================= */
const starRow     = document.getElementById('starRow');
const decorRow    = document.getElementById('decorRow');
const decorTabs   = document.getElementById('decorTabs');
const topTypeRow  = document.getElementById('topTypeRow');

/* è®“æ¨¹æ¢¢åˆ†é¡åˆ—ç”¨ã€Œæ–‡å­—åº•ç·š tabsã€æ¨£å¼ */
topTypeRow.classList.add('tabs');

const DECOR_TABS = [
  { key:'lights', label:'ç‡ˆé£¾' },
  { key:'bows',   label:'è´è¶çµ' },
  { key:'socks',  label:'è¥ªå­' },
  { key:'balls',  label:'çƒ' },
  { key:'others', label:'å…¶ä»–' },
];

// é è¨­åˆ†é ï¼šå¦‚æœä½ æƒ³ä¸€é–‹å§‹å°±çœ‹åˆ°è´è¶çµï¼Œå°± bows
let activeDecorTab = 'lights';

function decorTypeOf(d){
  if (d.id === 'light') return 'lights';
  if (d.id.startsWith('bow')) return 'bows';
  if (d.id.startsWith('sock')) return 'socks';
  if (d.id.startsWith('ball')) return 'balls';
  return 'others';
}

// tab è£¡é¢ chip é¡¯ç¤ºåå­—ï¼šè´è¶çµé¡åˆ¥å°±æŠŠã€Œè´è¶çµï¼šã€æ‹¿æ‰
function decorDisplayName(d){
  if (decorTypeOf(d) === 'bows') return (d.name || '').replace(/^è´è¶çµï¼š/,'').trim();
  return d.name;
}

/* ===== Tree Top åˆ†é¡ Tabs ===== */
function renderTopTypeRow(){
  const ICONS = { star:'æ˜Ÿæ˜Ÿ', bow:'è´è¶çµ', holiday:'å…¶ä»–', none:'ç„¡' };

  topTypeRow.innerHTML = TOP_TYPES
    .map(t => {
      const active = (t.id === state.topType) ? 'active' : '';
      const icon = ICONS[t.id] || t.name;
      return `<div class="tab ${active}" data-toptype="${t.id}" title="${t.name}">${icon}</div>`;
    })
    .join('');
}

/* ===== Tree Top æ¬¾å¼ Chips ===== */
function renderStarRow(){
  const list = getStarsByTopType(state.topType);
  // âœ… è®“ CSS çŸ¥é“ç›®å‰æ˜¯å“ªå€‹ Tree Top åˆ†é¡ï¼ˆç”¨ä¾†æ§åˆ¶ç¸®æ”¾ï¼‰
  starRow.dataset.toptype = state.topType;

  // è‹¥åˆ‡åˆ°æ–°åˆ†é¡ï¼Œè€Œç›®å‰é¸çš„ starId ä¸åœ¨æ­¤åˆ†é¡ï¼Œå°±è‡ªå‹•æ”¹æˆæ­¤åˆ†é¡ç¬¬ä¸€å€‹ï¼ˆæˆ– noneï¼‰
  if (!list.some(s => s.id === state.starId)){
    state.starId = (list[0] ? list[0].id : 'none');
  }

  starRow.innerHTML = list.map(s => {
    const active = (s.id === state.starId) ? 'active' : '';
    let vb = '0 0 520 240';
    // ğŸ€ è´è¶çµçš„ SVG æ˜¯ä»¥ (0,0) é™„è¿‘çš„å°åº§æ¨™ç•«çš„ï¼ˆæ²’æœ‰ translateï¼‰ï¼Œ
    // ç”¨å¤§ viewBox æœƒè®Šæˆç¸®åœ¨è§’è½ã€‚æ”¹ç”¨å° viewBox è®“å®ƒè‡ªå‹•æ”¾å¤§ç½®ä¸­ã€‚
    if (state.topType === 'bow') vb = '-80 -40 160 180';
    // ğŸ„ å…¶ä»–è–èª•å°ç‰©ï¼šç”¨æ–¹å½¢ viewBoxï¼Œç¸®åœ–ä¸æœƒè¢«å£“æ‰/å¤ªå°
    else if (state.topType === 'holiday') vb = '0 0 520 520';
    const thumb = (s.id === 'none')
      ? `<span class="emoji" aria-hidden="true">ğŸš«</span>`
      : `<svg viewBox="${vb}" preserveAspectRatio="xMidYMid meet" aria-hidden="true">${s.svg}</svg>`;
    return `<div class="chip icon ${active}" data-star="${s.id}" title="${s.name}">
      <span class="thumb">${thumb}</span>
    </div>`;
  }).join('');
}


/* ===== Decor Tabs + Chips ===== */
function renderDecorTabs(){
  decorTabs.innerHTML = DECOR_TABS
    .map(t => `<button class="decor-tab ${t.key===activeDecorTab?'active':''}" data-tab="${t.key}">${t.label}</button>`)
    .join('');
}

function renderDecorRow(){
  const list = DECORS.filter(d => decorTypeOf(d) === activeDecorTab);

  // è‹¥åˆ‡åˆ°æ–° tabï¼Œè€Œç›®å‰é¸çš„ decor ä¸åœ¨æ­¤åˆ†é¡ï¼Œå°±è‡ªå‹•æ”¹æˆæ­¤åˆ†é¡ç¬¬ä¸€å€‹
  if (!list.some(d => d.id === state.decorId) && list.length){
    state.decorId = list[0].id;
  }

  decorRow.innerHTML = list.map(d => {
    const active = (d.id === state.decorId) ? 'active' : '';
    const thumb = d.svg
      ? d.svg
      : `<span class="emoji" aria-hidden="true">âœ¨</span>`;
    return `<div class="chip icon ${active}" data-decor="${d.id}" title="${decorDisplayName(d)}">
      <span class="thumb">${thumb}</span>
    </div>`;
  }).join('');
}


function buildRows(){
  renderTopTypeRow();
  renderStarRow();
  renderDecorTabs();
  renderDecorRow();
}

buildRows();
renderTree();

/* ===== Events ===== */

// âœ… Tree Top åˆ†é¡ tabs
topTypeRow.addEventListener('click', (e)=>{
  const tab = e.target.closest('.tab');
  if(!tab) return;

  state.topType = tab.dataset.toptype;

  renderTopTypeRow();
  renderStarRow();
  renderTree();
}, { passive:false });

// Tree Top æ¬¾å¼ chips
starRow.addEventListener('pointerdown', (e)=>{ if(e.pointerType==='touch') e.preventDefault();
  const chip = e.target.closest('.chip');
  if(!chip) return;

  state.starId = chip.dataset.star;
  // âœ… é‡æ–°æ¸²æŸ“ç¬¬äºŒæ’ï¼Œç¢ºä¿ active ç‹€æ…‹èˆ‡ç¸®æ”¾éƒ½æ­£ç¢º
  renderStarRow();
  renderTree();
}, { passive:false });

// Decor Tabs
decorTabs.addEventListener('pointerdown', (e)=>{ if(e.pointerType==='touch') e.preventDefault();
  const btn = e.target.closest('.decor-tab');
  if(!btn) return;

  activeDecorTab = btn.dataset.tab;
  renderDecorTabs();
  renderDecorRow();
});

// Decor Chips
decorRow.addEventListener('pointerdown', (e)=>{ if(e.pointerType==='touch') e.preventDefault();
  const chip = e.target.closest('.chip');
  if(!chip) return;

  state.decorId = chip.dataset.decor;
  setActive(decorRow,'decor',state.decorId);
}, { passive:false });


/* =========================
       INTERACTION
    ========================= */
    function createSparks(x, y){
      for(let i=0;i<8;i++){
        const spark = document.createElement('div');
        spark.classList.add('spark');
        spark.style.left = x + 'px';
        spark.style.top  = y + 'px';

        const angle = (Math.PI*2*i)/8;
        const dist  = 30 + Math.random()*20;
        spark.style.setProperty('--tx', Math.cos(angle)*dist + 'px');
        spark.style.setProperty('--ty', Math.sin(angle)*dist + 'px');

        document.body.appendChild(spark);
        setTimeout(()=>spark.remove(), 1000);
      }
    }

    function addWish(){
      const wish = document.createElement('div');
      wish.className = 'wish';
      wish.textContent = wishes[Math.floor(Math.random()*wishes.length)];
      document.querySelector('.container').appendChild(wish);
      setTimeout(()=>wish.remove(), 4000);
    }

    function placeLight(relX, relY){
      const light = document.createElement('div');
      light.className = 'light';
      const c = lightColors[Math.floor(Math.random()*lightColors.length)];
      light.style.backgroundColor = c;
      light.style.color = c;
      light.style.left = relX + 'px';
      light.style.top  = relY + 'px';
      light.style.animationDelay = Math.random() + 's';
      treeStage.appendChild(light);

      state.lightCount++;
      state.placeCount++;
      counter.textContent = `LIGHTS: ${state.placeCount}`;
      if(state.placeCount % 5 === 0) addWish();
    }

    function placeDecor(relX, relY){
      const d = DECORS.find(x=>x.id===state.decorId);
      const el = document.createElement('div');
      el.className = 'decor';
      el.style.left = relX + 'px';
      el.style.top  = relY + 'px';
      el.innerHTML = d.svg;
      treeStage.appendChild(el);

      // âœ… è¨ˆæ•¸å™¨ï¼šæ¯æ”¾ä¸€æ¬¡éƒ½ç´¯åŠ ï¼ˆä¸ç®¡æ˜¯ç‡ˆé£¾æˆ–è£é£¾å“ï¼‰
      state.placeCount++;
      counter.textContent = `LIGHTS: ${state.placeCount}`;
      if(state.placeCount % 5 === 0) addWish();
    }

    function handlePlace(clientX, clientY){
      const rect = treeStage.getBoundingClientRect();
      const relX = clientX - rect.left;
      const relY = clientY - rect.top;

      if(relY < rect.height*0.08 || relY > rect.height*0.96) return;

      // æ ¹æ“šé¸æ“‡çš„è£é£¾å“é¡å‹æ±ºå®šæ”¾ç½®ä»€éº¼
      if(state.decorId === 'light') {
        placeLight(relX, relY);
      } else {
        placeDecor(relX, relY);
      }

      createSparks(clientX, clientY);

      treeStage.style.transform = 'scale(1.01)';
      setTimeout(()=>treeStage.style.transform='scale(1)', 90);
    }

    // âœ… ç”¨ pointerdown å–ä»£ clickï¼šæ‰‹æ©Ÿ/å¹³æ¿æ›´ç©©ï¼Œè¨ˆæ•¸å™¨ä¹Ÿæœƒæ­£å¸¸ç´¯åŠ 
    treeStage.addEventListener('pointerdown', (e)=>{
      // é¿å…åœ¨å¯æ»¾å‹•å€åŸŸèª¤è§¸é€ æˆé é¢æ²å‹•
      if(e.pointerType === 'touch') e.preventDefault();
      handlePlace(e.clientX, e.clientY);
    }, { passive: false });
    // Clear button (tap once to delete immediately)
    const clearBtn = document.getElementById('clearBtn');
    clearBtn.addEventListener('pointerdown', (e)=>{
      // prevent page scroll / ghost clicks on mobile
      if(e.pointerType === 'touch') e.preventDefault();
      clearAll();
      clearBtn.style.transform = 'scale(0.92)';
      setTimeout(()=>clearBtn.style.transform='', 90);
    }, { passive:false });

    /* =========================
       Bottom panel: collapse / expand (avoid blocking the tree)
    ========================= */
    const controlsEl = document.querySelector('.controls');
    const panelHandle = document.getElementById('panelHandle');
    const panelToggle = document.getElementById('panelToggle');
    const containerEl = document.querySelector('.container');

    function syncBottomSpace(){
      const h = controlsEl.getBoundingClientRect().height;
      // leave a tiny buffer so the tree never touches the panel
      containerEl.style.paddingBottom = Math.max(16, h + 12) + 'px';
      // signature follows the panel
      const sig = document.getElementById('signature');
      if(sig){
        sig.style.bottom = (h + 10) + 'px';
      }
    }

    function setCollapsed(collapsed){
      controlsEl.classList.toggle('collapsed', collapsed);
      syncBottomSpace();
    }

    // default: expanded on desktop, collapsed on small screens a bit
    setTimeout(()=>{ 
      if(window.innerWidth < 480) setCollapsed(false);
      else syncBottomSpace();
    }, 0);

    function togglePanel(){
      setCollapsed(!controlsEl.classList.contains('collapsed'));
    }

    panelHandle.addEventListener('click', (e)=>{
      // ignore clicks on actual buttons inside handle
      if(e.target === panelToggle || panelToggle.contains(e.target)) return;
      togglePanel();
    });
    panelToggle.addEventListener('click', (e)=>{
      e.stopPropagation();
      togglePanel();
    });

    // swipe down to collapse / swipe up to expand (mobile)
    let startY = null;
    panelHandle.addEventListener('pointerdown', (e)=>{
      startY = e.clientY;
    });
    panelHandle.addEventListener('pointerup', (e)=>{
      if(startY == null) return;
      const dy = e.clientY - startY;
      startY = null;
      if(Math.abs(dy) < 18) return;
      if(dy > 0) setCollapsed(true);  // swipe down
      else setCollapsed(false);       // swipe up
    });

    window.addEventListener('resize', syncBottomSpace);

    document.addEventListener('keydown', (e)=>{
      if(e.code === 'Space') clearAll();
    });

    /* =========================
       MUSIC
    ========================= */
    let isPlaying = false;
    const musicBtn = document.getElementById('musicBtn');
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    let oscillator = null;
    let gainNode = null;

    // A longer, nicer loop (Jingle Bells-ish). Durations are in seconds.
    const melodyNotes = [
      { freq: 659.25, duration: 0.28 }, // E
      { freq: 659.25, duration: 0.28 }, // E
      { freq: 659.25, duration: 0.56 }, // E
      { freq: 659.25, duration: 0.28 }, // E
      { freq: 659.25, duration: 0.28 }, // E
      { freq: 659.25, duration: 0.56 }, // E
      { freq: 659.25, duration: 0.28 }, // E
      { freq: 783.99, duration: 0.28 }, // G
      { freq: 523.25, duration: 0.28 }, // C
      { freq: 587.33, duration: 0.28 }, // D
      { freq: 659.25, duration: 0.84 }, // E

      { freq: 698.46, duration: 0.28 }, // F
      { freq: 698.46, duration: 0.28 }, // F
      { freq: 698.46, duration: 0.56 }, // F
      { freq: 698.46, duration: 0.28 }, // F
      { freq: 659.25, duration: 0.28 }, // E
      { freq: 659.25, duration: 0.28 }, // E
      { freq: 659.25, duration: 0.28 }, // E
      { freq: 659.25, duration: 0.28 }, // E
      { freq: 587.33, duration: 0.28 }, // D
      { freq: 587.33, duration: 0.28 }, // D
      { freq: 659.25, duration: 0.28 }, // E
      { freq: 587.33, duration: 0.56 }, // D
      { freq: 783.99, duration: 0.56 }, // G
    ];

    let currentNoteIndex = 0;
    let melodyTimer = null;

    function stopMelodyTimer(){
      if(melodyTimer){
        clearTimeout(melodyTimer);
        melodyTimer = null;
      }
    }

    function playNote(frequency, duration){
      if(!isPlaying) return;
      oscillator = audioContext.createOscillator();
      gainNode = audioContext.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.frequency.value = frequency;
      oscillator.type = 'sine';

      const t0 = audioContext.currentTime;
      const attack = 0.01;
      const release = Math.max(0.05, duration * 0.35);

      gainNode.gain.setValueAtTime(0.0001, t0);
      gainNode.gain.exponentialRampToValueAtTime(0.10, t0 + attack);
      gainNode.gain.exponentialRampToValueAtTime(0.0001, t0 + duration + release);

      oscillator.start(t0);
      oscillator.stop(t0 + duration + release);
    }

    function scheduleNext(){
      if(!isPlaying) return;
      const note = melodyNotes[currentNoteIndex];
      playNote(note.freq, note.duration);

      currentNoteIndex = (currentNoteIndex + 1) % melodyNotes.length;

      // schedule based on the note duration (so it feels longer and less rushed)
      const gapMs = 25;
      melodyTimer = setTimeout(scheduleNext, Math.max(80, note.duration * 1000 + gapMs));
    }

    musicBtn.addEventListener('click', async ()=>{
      if(audioContext.state === 'suspended'){
        try{ await audioContext.resume(); }catch(e){}
      }
      isPlaying = !isPlaying;

      if(isPlaying){
        musicBtn.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M9 18V6l12-2v12"/><path fill="currentColor" d="M7.5 20.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/><path fill="currentColor" d="M19.5 18.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/></svg>`;
        musicBtn.style.background = 'rgba(255,255,255,.22)';
        stopMelodyTimer();
        currentNoteIndex = 0;
        scheduleNext();
      }else{
        musicBtn.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M9 18V6l12-2v12"/><path fill="currentColor" d="M7.5 20.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/><path fill="currentColor" d="M19.5 18.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/></svg>`;
        musicBtn.style.background = 'rgba(255,255,255,.12)';
        stopMelodyTimer();
        try{ if(oscillator) oscillator.stop(); }catch(e){}
      }
    });

/* =========================
       SIGNATURE
    ========================= */
    const SIGN_KEY = "xmas_signature_v3";
    const sigTextEl = document.getElementById('sigText');
    const sigDateEl = document.getElementById('sigDate');
    const signBtn = document.getElementById('signBtn');
    const signatureEl = document.getElementById('signature');

    function formatDate(d){
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${yyyy}-${mm}-${dd}`;
    }
    function applySignature(text){
      const clean = (text||"").trim().slice(0,28);
      const finalText = clean.length ? clean : "Merry Christmas!!!";
      sigTextEl.textContent = finalText;
      try{ localStorage.setItem(SIGN_KEY, finalText); }catch(e){}
    }
    function askSignature(){
      const current = (localStorage.getItem(SIGN_KEY) || sigTextEl.textContent || "").trim();
      const next = prompt("è¼¸å…¥ä½ çš„ç½²åï¼ˆæœƒå‡ºç¾åœ¨æˆªåœ–ä¸­ï¼‰", current);
      if(next === null) return;
      applySignature(next);
    }
    applySignature(localStorage.getItem(SIGN_KEY) || "Merry Christmas!!!");
    sigDateEl.textContent = formatDate(new Date());

    signBtn.addEventListener('click', askSignature);
    document.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase() === 's') askSignature();
    });

    // Mobile long press
    let pressTimer = null;
    signatureEl.addEventListener('touchstart', ()=>{
      pressTimer = setTimeout(()=>askSignature(), 450);
    }, {passive:true});
    signatureEl.addEventListener('touchend', ()=>{
      if(pressTimer) clearTimeout(pressTimer);
    });

    /* =========================
       SCREENSHOT
    ========================= */
    const captureBtn = document.getElementById('captureBtn');
    const flash = document.getElementById('flash');
    const notification = document.getElementById('notification');
    const instructionEl = document.querySelector('.instruction');

    captureBtn.addEventListener('click', async ()=>{
      // Show a subtle flash to the user, but ensure it does NOT get captured in the screenshot.
      flash.classList.add('active');
      await new Promise(r=>setTimeout(r, 200));
      flash.classList.remove('active');

      // Hide UI for a clean capture
      controlsEl.style.display = 'none';
      instructionEl.style.display = 'none';
      counter.style.display = 'none';

      // Freeze light glow for screenshot
      document.body.classList.add('capturing');

      // Make sure flash overlay is not captured by html2canvas
      const prevFlashDisplay = flash.style.display;
      flash.style.display = 'none';

      await new Promise(r=>setTimeout(r, 180));

      try{
        const canvas = await html2canvas(document.body, {
          backgroundColor: null,
          scale: 2,
          logging: false,
          useCORS: true
        });

        canvas.toBlob((blob)=>{
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          const date = new Date().toISOString().slice(0,10);
          link.download = `christmas-tree-${date}.png`;
          link.href = url;
          link.click();
          URL.revokeObjectURL(url);

          notification.classList.add('show');
          setTimeout(()=>notification.classList.remove('show'), 2000);
        });
      }catch(err){
        console.error('æˆªåœ–å¤±æ•—:', err);
      }

      // Restore UI & flash overlay
      document.body.classList.remove('capturing');
      flash.style.display = prevFlashDisplay || '';
      controlsEl.style.display = 'flex';
      instructionEl.style.display = 'block';
      counter.style.display = 'block';
    });

    /* =========================
       SNOW
    ========================= */
    const snowCanvas = document.getElementById('snowCanvas');
    const sctx = snowCanvas.getContext('2d');
    let SW, SH, flakes = [];
    function resizeSnow(){
      SW = snowCanvas.width = window.innerWidth;
      SH = snowCanvas.height = window.innerHeight;
      const n = Math.min(180, Math.floor(SW / 6));
      flakes = Array.from({length:n}, ()=>({
        x: Math.random()*SW,
        y: Math.random()*SH,
        r: Math.random()*1.8 + 0.6,
        v: Math.random()*0.95 + 0.25,
        a: Math.random()*Math.PI*2
      }));
    }
    window.addEventListener('resize', resizeSnow);
    resizeSnow();

    function drawSnow(){
      sctx.clearRect(0,0,SW,SH);
      sctx.fillStyle = 'rgba(255,255,255,0.65)';
      for(const f of flakes){
        sctx.beginPath();
        sctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
        sctx.fill();
        f.y += f.v;
        f.x += Math.sin(f.a) * 0.35;
        f.a += 0.01;
        if(f.y > SH + 10){
          f.y = -10;
          f.x = Math.random()*SW;
        }
      }
      requestAnimationFrame(drawSnow);
    }
    drawSnow();

    /* =========================
       SVGs
    ========================= */
    // å¯«å¯¦é¢¨æ ¼è–èª•æ¨¹ï¼ˆæ¨¡ä»¿çœŸå¯¦è–èª•æ¨¹çš„å±¤æ¬¡æ„Ÿï¼‰
    function realisticTree(){
      return `
        ${trunk()}
        <!-- åº•å±¤ - è¶…å¯¬è¶…èƒ– -->
        <path d="M260 550 L80 630 L440 630 Z" fill="#1a4d3a" opacity="0.9"/>
        <path d="M260 540 L90 620 L430 620 Z" fill="#1e5842"/>
        <path d="M260 530 L100 610 L420 610 Z" fill="#225d47" opacity="0.95"/>
        
        <!-- ä¸­ä¸‹å±¤ - è¶…å¯¬è¶…èƒ– -->
        <path d="M260 480 L95 570 L425 570 Z" fill="#1a4d3a" opacity="0.9"/>
        <path d="M260 470 L105 560 L415 560 Z" fill="#1e5842"/>
        <path d="M260 460 L115 550 L405 550 Z" fill="#225d47" opacity="0.95"/>
        
        <!-- ä¸­å±¤ - è¶…å¯¬è¶…èƒ– -->
        <path d="M260 410 L110 500 L410 500 Z" fill="#1a4d3a" opacity="0.9"/>
        <path d="M260 400 L120 490 L400 490 Z" fill="#1e5842"/>
        <path d="M260 390 L130 480 L390 480 Z" fill="#225d47" opacity="0.95"/>
        
        <!-- ä¸­ä¸Šå±¤ - æ›´å¯¬ -->
        <path d="M260 340 L130 430 L390 430 Z" fill="#1a4d3a" opacity="0.9"/>
        <path d="M260 330 L140 420 L380 420 Z" fill="#1e5842"/>
        <path d="M260 320 L150 410 L370 410 Z" fill="#225d47" opacity="0.95"/>
        
        <!-- ä¸Šå±¤ -->
        <path d="M260 280 L145 360 L375 360 Z" fill="#1a4d3a" opacity="0.9"/>
        <path d="M260 270 L155 350 L365 350 Z" fill="#1e5842"/>
        <path d="M260 260 L165 340 L355 340 Z" fill="#225d47" opacity="0.95"/>
        
        <!-- é ‚å±¤ -->
        <path d="M260 220 L160 300 L360 300 Z" fill="#1a4d3a" opacity="0.9"/>
        <path d="M260 210 L170 290 L350 290 Z" fill="#1e5842"/>
        <path d="M260 200 L180 280 L340 280 Z" fill="#225d47" opacity="0.95"/>
        
        <!-- æ¨¹å°– -->
        <path d="M260 150 L190 230 L330 230 Z" fill="#1e5842"/>
        <path d="M260 160 L195 225 L325 225 Z" fill="#225d47"/>
        
        <!-- æ·»åŠ ä¸€äº›ç´°ç¯€çš„ææ¢æ•ˆæœ -->
        <path d="M80 630 L85 625 L90 620 L95 615" stroke="#0f3d2d" stroke-width="2" fill="none" opacity="0.6"/>
        <path d="M440 630 L435 625 L430 620 L425 615" stroke="#0f3d2d" stroke-width="2" fill="none" opacity="0.6"/>
        <path d="M95 570 L100 565 L105 560" stroke="#0f3d2d" stroke-width="2" fill="none" opacity="0.6"/>
        <path d="M425 570 L420 565 L415 560" stroke="#0f3d2d" stroke-width="2" fill="none" opacity="0.6"/>
      `;
    }
    
    function starBasePath(fill, stroke){
      return `
        <g transform="translate(260 120)">
          <path d="M0-32 L10-8 L36-8 L15 6 L24 30 L0 15 L-24 30 L-15 6 L-36-8 L-10-8 Z"
                fill="${fill}" stroke="${stroke}" stroke-width="5" stroke-linejoin="round"/>
        </g>`;
    }
    function starSVG_A(){ return starBasePath('#f6d56b','rgba(0,0,0,.22)'); }
    function starSVG_B(){
      return `
        <g transform="translate(260 120)">
          <path d="M0-30 C6-16,18-10,30-8 C18-2,10 8,0 24 C-10 8,-18-2,-30-8 C-18-10,-6-16,0-30Z"
                fill="#ffd93d" stroke="rgba(0,0,0,.22)" stroke-width="5" stroke-linejoin="round"/>
        </g>`;
    }
    function starSVG_Pink(){ return starBasePath('#ff8fab','rgba(0,0,0,.22)'); }
    function starSVG_Blue(){ return starBasePath('#7dd3fc','rgba(0,0,0,.22)'); }
    function starSVG_Gold(){
      return `
        <g transform="translate(260 120)">
          <path d="M0-32 L10-8 L36-8 L15 6 L24 30 L0 15 L-24 30 L-15 6 L-36-8 L-10-8 Z"
                fill="#fbbf24" stroke="rgba(0,0,0,.22)" stroke-width="5" stroke-linejoin="round"/>
          <circle cx="0" cy="0" r="8" fill="#fcd34d" opacity="0.8"/>
          <circle cx="0" cy="0" r="4" fill="#fef08a"/>
        </g>`;
    }
    function starSVG_Red(){
      return `
        <g transform="translate(260 120)">
          <path d="M0-32 L10-8 L36-8 L15 6 L24 30 L0 15 L-24 30 L-15 6 L-36-8 L-10-8 Z"
                fill="#ef4444" stroke="rgba(0,0,0,.22)" stroke-width="5" stroke-linejoin="round"/>
          <path d="M0-20 L6-6 L20-6 L10 2 L14 16 L0 8 L-14 16 L-10 2 L-20-6 L-6-6 Z"
                fill="#fca5a5" opacity="0.7"/>
        </g>`;
    }
    function starSVG_3D(){
      return `
        <g transform="translate(260 120)">
          <path d="M0-32 L10-8 L36-8 L15 6 L24 30 L0 15 L-24 30 L-15 6 L-36-8 L-10-8 Z"
                fill="#fbbf24" stroke="rgba(0,0,0,.22)" stroke-width="5" stroke-linejoin="round"/>
          <path d="M0-32 L10-8 L0 0 L-10-8 Z" fill="#fcd34d"/>
          <path d="M10-8 L36-8 L15 6 L0 0 Z" fill="#fde68a"/>
          <path d="M15 6 L24 30 L0 15 L0 0 Z" fill="#fef3c7"/>
          <path d="M0 15 L-24 30 L-15 6 L0 0 Z" fill="#fde68a"/>
          <path d="M-15 6 L-36-8 L-10-8 L0 0 Z" fill="#fcd34d"/>
        </g>`;
    }
    function starSVG_Sparkle(){
      return `
        <g transform="translate(260 120)">
          <path d="M0-32 L10-8 L36-8 L15 6 L24 30 L0 15 L-24 30 L-15 6 L-36-8 L-10-8 Z"
                fill="#fef08a" stroke="rgba(0,0,0,.22)" stroke-width="5" stroke-linejoin="round"/>
          <circle cx="0" cy="-15" r="3" fill="#fff"/>
          <circle cx="15" cy="-2" r="2.5" fill="#fff"/>
          <circle cx="10" cy="12" r="2" fill="#fff"/>
          <circle cx="-10" cy="12" r="2" fill="#fff"/>
          <circle cx="-15" cy="-2" r="2.5" fill="#fff"/>
          <path d="M0-28 L2-22 L0-16 L-2-22 Z" fill="#fff"/>
          <path d="M20 2 L22 6 L20 10 L18 6 Z" fill="#fff"/>
        </g>`;
    }
    function topBowSVG(){
      return `
        <g transform="translate(260 126)">
          <path d="M0 0 C-10 -12,-28 -16,-36 -6 C-42 2,-30 12,-14 10 Z"
                fill="#ff8fab" stroke="rgba(0,0,0,.22)" stroke-width="5" stroke-linejoin="round"/>
          <path d="M0 0 C10 -12,28 -16,36 -6 C42 2,30 12,14 10 Z"
                fill="#ff8fab" stroke="rgba(0,0,0,.22)" stroke-width="5" stroke-linejoin="round"/>
          <circle cx="0" cy="6" r="7" fill="#ff6b9a" stroke="rgba(0,0,0,.22)" stroke-width="5"/>
        </g>`;
    }
    function topBowRed(){
      return `
        <g transform="translate(260 126)">
          <path d="M0 0 C-10 -12,-28 -16,-36 -6 C-42 2,-30 12,-14 10 Z"
                fill="#dc2626" stroke="rgba(0,0,0,.22)" stroke-width="5" stroke-linejoin="round"/>
          <path d="M0 0 C10 -12,28 -16,36 -6 C42 2,30 12,14 10 Z"
                fill="#dc2626" stroke="rgba(0,0,0,.22)" stroke-width="5" stroke-linejoin="round"/>
          <circle cx="0" cy="6" r="7" fill="#ef4444" stroke="rgba(0,0,0,.22)" stroke-width="5"/>
          <path d="M-3 6 L3 6" stroke="#fff" stroke-width="2" opacity="0.6"/>
        </g>`;
    }
    function angelSVG(){
      return `
        <g transform="translate(260 120)">
          <!-- å…‰ç’° -->
          <circle cx="0" cy="-28" r="10" fill="none" stroke="#fbbf24" stroke-width="3" opacity="0.8"/>
          <!-- é ­ -->
          <circle cx="0" cy="-12" r="12" fill="#fce7b2" stroke="rgba(0,0,0,.18)" stroke-width="4"/>
          <!-- èº«é«” -->
          <path d="M0 0 L-18 20 L-10 28 L0 22 L10 28 L18 20 Z"
                fill="#fff" stroke="rgba(0,0,0,.18)" stroke-width="4" stroke-linejoin="round"/>
          <!-- ç¿…è†€ -->
          <path d="M-5 5 C-20 0,-30 -5,-35 -12 C-38 -16,-35 -20,-30 -18 C-22 -14,-15 -8,-5 -2 Z"
                fill="#e0f2fe" stroke="rgba(0,0,0,.18)" stroke-width="3" stroke-linejoin="round"/>
          <path d="M5 5 C20 0,30 -5,35 -12 C38 -16,35 -20,30 -18 C22 -14,15 -8,5 -2 Z"
                fill="#e0f2fe" stroke="rgba(0,0,0,.18)" stroke-width="3" stroke-linejoin="round"/>
        </g>`;
    }

    function trunk(){
      return `<rect x="248" y="585" width="24" height="95" rx="8" fill="#8a5a44"/>`;
    }

    function wrapDecor(svg){ return `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">${svg}</svg>`; }
function decor_lightIcon(){
  return wrapDecor(`
    <!-- å½©è‰²ç‡ˆé£¾å°åœ–ç¤ºï¼ˆç”¨åœ¨é¸é …åˆ—ï¼‰ -->
    <g opacity="0.95">
      <!-- ç·š -->
      <path d="M8 22 C18 14, 30 14, 40 22 C50 30, 56 30, 58 22"
            fill="none" stroke="rgba(255,255,255,0.55)" stroke-width="2.4" stroke-linecap="round"/>
      <!-- ç‡ˆæ³¡ 1 -->
      <g transform="translate(18 30)">
        <circle cx="0" cy="0" r="7.8" fill="#ff6b6b" opacity="0.95"/>
        <circle cx="0" cy="0" r="11" fill="#ff6b6b" opacity="0.16"/>
        <rect x="-3.6" y="-12" width="7.2" height="5.2" rx="2" fill="rgba(255,255,255,0.45)"/>
      </g>
      <!-- ç‡ˆæ³¡ 2 -->
      <g transform="translate(32 22)">
        <circle cx="0" cy="0" r="7.8" fill="#ffd93d" opacity="0.95"/>
        <circle cx="0" cy="0" r="11" fill="#ffd93d" opacity="0.16"/>
        <rect x="-3.6" y="-12" width="7.2" height="5.2" rx="2" fill="rgba(255,255,255,0.45)"/>
      </g>
      <!-- ç‡ˆæ³¡ 3 -->
      <g transform="translate(46 30)">
        <circle cx="0" cy="0" r="7.8" fill="#4d96ff" opacity="0.95"/>
        <circle cx="0" cy="0" r="11" fill="#4d96ff" opacity="0.16"/>
        <rect x="-3.6" y="-12" width="7.2" height="5.2" rx="2" fill="rgba(255,255,255,0.45)"/>
      </g>
    </g>
  `);
}
    function decor_ball(){
      return wrapDecor(`
        <defs>
          <radialGradient id="ballGrad1">
            <stop offset="0%" stop-color="#ff9999"/>
            <stop offset="100%" stop-color="#ff7a7a"/>
          </radialGradient>
        </defs>
        <circle cx="32" cy="36" r="16" fill="url(#ballGrad1)" stroke="#ff6666" stroke-width="2.5" opacity="0.92"/>
        <ellipse cx="25" cy="29" rx="7" ry="9" fill="#ffcccc" opacity="0.55"/>
        <circle cx="36" cy="40" r="3" fill="#ff8888" opacity="0.4"/>
        <path d="M28 21 C30 19,34 19,36 21" stroke="#e6b380" stroke-width="3.5" stroke-linecap="round" fill="none"/>
        <rect x="27" y="15" width="10" height="6" rx="3" fill="#f4d4a8" stroke="#d9b889" stroke-width="2.5"/>
      `);
    }
    function decor_ball2(){
      return wrapDecor(`
        <defs>
          <radialGradient id="ballGrad2">
            <stop offset="0%" stop-color="#8db3ff"/>
            <stop offset="100%" stop-color="#5a9bff"/>
          </radialGradient>
        </defs>
        <circle cx="32" cy="36" r="16" fill="url(#ballGrad2)" stroke="#4d8eef" stroke-width="2.5" opacity="0.92"/>
        <ellipse cx="24" cy="28" rx="8" ry="10" fill="#cce0ff" opacity="0.6"/>
        <circle cx="38" cy="39" r="3.5" fill="#a3c7ff" opacity="0.45"/>
        <path d="M28 21 C30 19,34 19,36 21" stroke="#e6b380" stroke-width="3.5" stroke-linecap="round" fill="none"/>
        <rect x="27" y="15" width="10" height="6" rx="3" fill="#f4d4a8" stroke="#d9b889" stroke-width="2.5"/>
      `);
    }
   
    function decor_garland(){
      return wrapDecor(`
        <!-- å½©å¸¶ç·šæ¢ -->
        <path d="M10 24 Q18 28,26 24 Q34 20,42 24 Q50 28,54 24"
              fill="none" stroke="#7dd9a3" stroke-width="4" stroke-linecap="round" opacity="0.85"/>
        <path d="M10 24 Q18 28,26 24 Q34 20,42 24 Q50 28,54 24"
              fill="none" stroke="#d4e8d4" stroke-width="2.5" stroke-linecap="round" opacity="0.6"/>
        
        <!-- è£é£¾ç‡ˆæ³¡ -->
        <ellipse cx="18" cy="30" rx="5" ry="6" fill="#ffe680" stroke="#ffd966" stroke-width="2" opacity="0.92"/>
        <ellipse cx="16" cy="28" rx="2" ry="3" fill="#fff9cc" opacity="0.6"/>
        
        <ellipse cx="34" cy="22" rx="5" ry="6" fill="#80b3ff" stroke="#66a3ff" stroke-width="2" opacity="0.92"/>
        <ellipse cx="32" cy="20" rx="2" ry="3" fill="#cce0ff" opacity="0.6"/>
        
        <ellipse cx="50" cy="28" rx="5" ry="6" fill="#ff9999" stroke="#ff8888" stroke-width="2" opacity="0.92"/>
        <ellipse cx="48" cy="26" rx="2" ry="3" fill="#ffcccc" opacity="0.6"/>
        
        <!-- å‚æ›çš„è£é£¾ -->
        <path d="M18 36 L18 44" stroke="#ffe680" stroke-width="2" opacity="0.7"/>
        <circle cx="18" cy="46" r="3" fill="#ffe680" opacity="0.85"/>
        
        <path d="M34 28 L34 36" stroke="#80b3ff" stroke-width="2" opacity="0.7"/>
        <circle cx="34" cy="38" r="3" fill="#80b3ff" opacity="0.85"/>
        
        <path d="M50 34 L50 42" stroke="#ff9999" stroke-width="2" opacity="0.7"/>
        <circle cx="50" cy="44" r="3" fill="#ff9999" opacity="0.85"/>
      `);
    }
function decor_bell(){
  return wrapDecor(`
    <g>
      <!-- éˆ´éºä¸»é«” -->
      <path d="M20 30
               C20 20,44 20,44 30
               C44 44,38 52,32 54
               C26 52,20 44,20 30 Z"
            fill="#f7d86a"
            stroke="rgba(0,0,0,.18)"
            stroke-width="2.4"
            stroke-linejoin="round"/>

      <!-- äº®é¢ -->
      <path d="M26 28
               C26 24,32 22,36 24
               C32 24,30 26,30 30
               C30 34,28 36,26 36 Z"
            fill="#fff3b5"
            opacity="0.85"/>

      <!-- éˆ´éºå£ -->
      <path d="M22 34 C26 40,38 40,42 34"
            fill="none"
            stroke="rgba(0,0,0,.12)"
            stroke-width="2.2"
            stroke-linecap="round"/>

      <!-- å°çƒ -->
      <circle cx="32" cy="54" r="4.6"
              fill="#ff8b8b"
              stroke="rgba(0,0,0,.18)"
              stroke-width="2.0"/>

      <!-- ä¸Šé¢æ›ç’° -->
      <rect x="27" y="16" width="10" height="6" rx="3"
            fill="#d9b889"
            stroke="rgba(0,0,0,.18)"
            stroke-width="2.0"/>
      <circle cx="32" cy="14" r="4.2"
              fill="#f2d3aa"
              stroke="rgba(0,0,0,.18)"
              stroke-width="2.0"/>
    </g>
  `);
}
    function decor_gift(){
      return wrapDecor(`
        <!-- ç¦®ç‰©ç›’ä¸»é«” -->
        <rect x="18" y="30" width="28" height="24" rx="3" fill="#80b3ff" stroke="#66a3ff" stroke-width="2.5" opacity="0.92"/>
        <ellipse cx="26" cy="38" rx="6" ry="8" fill="#b3d9ff" opacity="0.5"/>
        
        <!-- è“‹å­ -->
        <rect x="16" y="26" width="32" height="6" rx="2" fill="#5a9bff" stroke="#4d8eef" stroke-width="2.5" opacity="0.92"/>
        
        <!-- ç·å¸¶ - å‚ç›´ -->
        <rect x="30" y="26" width="4" height="28" fill="#ffd966" opacity="0.9"/>
        <ellipse cx="32" cy="36" rx="1.5" ry="4" fill="#fff4cc" opacity="0.5"/>
        
        <!-- ç·å¸¶ - æ°´å¹³ -->
        <rect x="16" y="40" width="32" height="4" fill="#ffd966" opacity="0.9"/>
        
        <!-- è´è¶çµ -->
        <path d="M24 22 C22 20,22 18,24 16 C26 14,28 16,28 18 L32 18 C32 16,34 14,36 16 C38 18,38 20,36 22 Z"
              fill="#ffe680" stroke="#ffd966" stroke-width="2" opacity="0.92"/>
        <circle cx="32" cy="22" r="3" fill="#ffd966" opacity="0.9"/>
      `);
    }

    function decor_snow(){
      return wrapDecor(`
        <path d="M32 14 L32 50" stroke="#f0f8ff" stroke-width="5" stroke-linecap="round" opacity="0.9"/>
        <path d="M14 32 L50 32" stroke="#f0f8ff" stroke-width="5" stroke-linecap="round" opacity="0.9"/>
        <path d="M20 20 L44 44" stroke="#e6f2ff" stroke-width="4.5" stroke-linecap="round" opacity="0.85"/>
        <path d="M44 20 L20 44" stroke="#e6f2ff" stroke-width="4.5" stroke-linecap="round" opacity="0.85"/>
        <circle cx="32" cy="32" r="7" fill="#ffffff" opacity="0.7"/>
        <circle cx="32" cy="32" r="4" fill="#f8fcff" opacity="0.85"/>
        <circle cx="28" cy="30" r="2" fill="#ffffff" opacity="0.6"/>
      `);
    }
    function decor_starMini(){
      return wrapDecor(`
        <path d="M32 14 L36 26 L50 26 L39 34 L43 46 L32 38 L21 46 L25 34 L14 26 L28 26 Z"
              fill="#ffe680" stroke="#ffd966" stroke-width="2.5" stroke-linejoin="round" opacity="0.92"/>
        <path d="M32 20 L34 26 L40 26 L35 30 L37 36 L32 32 L27 36 L29 30 L24 26 L30 26 Z"
              fill="#fff9cc" opacity="0.6"/>
        <circle cx="32" cy="28" r="2" fill="#ffffff" opacity="0.7"/>
      `);
    }
    function decor_candle(){
      return wrapDecor(`
        <rect x="25" y="24" width="14" height="28" rx="5" fill="#fff5e6" stroke="#ffe0b3" stroke-width="2.5" opacity="0.95"/>
        <ellipse cx="28" cy="32" rx="3" ry="6" fill="#ffffff" opacity="0.5"/>
        <path d="M32 12 C29 17,31 19,32 21 C33 19,35 17,32 12Z"
              fill="#ffe680" stroke="#ffd966" stroke-width="2" stroke-linejoin="round" opacity="0.92"/>
        <ellipse cx="32" cy="16" rx="2" ry="3" fill="#fff9cc" opacity="0.7"/>
        <path d="M28 38 L36 38" stroke="#ffb3c6" stroke-width="5" stroke-linecap="round" opacity="0.8"/>
      `);
    }
    function decor_leaf(){
      return wrapDecor(`
        <path d="M22 42 C18 26,28 16,42 20 C48 22,52 28,50 36 C48 48,34 54,22 42Z"
              fill="#5a9b6e" stroke="#4d8a60" stroke-width="2.5" stroke-linejoin="round" opacity="0.92"/>
        <ellipse cx="34" cy="28" rx="6" ry="8" fill="#8fc7a0" opacity="0.5"/>
        <path d="M26 40 C32 36,38 32,44 24" stroke="#4d8a60" stroke-width="3" stroke-linecap="round" opacity="0.6"/>
        <path d="M28 36 C32 34,36 30,40 26" stroke="#7ab88a" stroke-width="2" stroke-linecap="round" opacity="0.5"/>
      `);
    }
    function decor_ballGold(){
      return wrapDecor(`
        <defs>
          <radialGradient id="ballGradGold">
            <stop offset="0%" stop-color="#ffd966"/>
            <stop offset="100%" stop-color="#f4c542"/>
          </radialGradient>
        </defs>
        <circle cx="32" cy="36" r="16" fill="url(#ballGradGold)" stroke="#e6b333" stroke-width="2.5" opacity="0.92"/>
        <ellipse cx="24" cy="28" rx="8" ry="10" fill="#fff4cc" opacity="0.6"/>
        <circle cx="37" cy="40" r="4" fill="#ffe680" opacity="0.4"/>
        <path d="M28 21 C30 19,34 19,36 21" stroke="#e6b380" stroke-width="3.5" stroke-linecap="round" fill="none"/>
        <rect x="27" y="15" width="10" height="6" rx="3" fill="#f4d4a8" stroke="#d9b889" stroke-width="2.5"/>
      `);
    }
    function decor_ballPurple(){
      return wrapDecor(`
        <defs>
          <radialGradient id="ballGradPurple">
            <stop offset="0%" stop-color="#c9a3ff"/>
            <stop offset="100%" stop-color="#a855f7"/>
          </radialGradient>
        </defs>
        <circle cx="32" cy="36" r="16" fill="url(#ballGradPurple)" stroke="#9845e7" stroke-width="2.5" opacity="0.92"/>
        <ellipse cx="25" cy="30" rx="7" ry="8" fill="#e6d4ff" opacity="0.6"/>
        <circle cx="36" cy="39" r="3" fill="#d4b3ff" opacity="0.5"/>
        <path d="M28 21 C30 19,34 19,36 21" stroke="#e6b380" stroke-width="3.5" stroke-linecap="round" fill="none"/>
        <rect x="27" y="15" width="10" height="6" rx="3" fill="#f4d4a8" stroke="#d9b889" stroke-width="2.5"/>
      `);
    }
    function decor_heart(){
      return wrapDecor(`
        <path d="M32 48 L20 34 C14 28,14 20,20 16 C24 13,28 14,32 18 C36 14,40 13,44 16 C50 20,50 28,44 34 Z"
              fill="#ff9999" stroke="#ff8888" stroke-width="2.5" stroke-linejoin="round" opacity="0.92"/>
        <ellipse cx="24" cy="23" rx="5" ry="6" fill="#ffcccc" opacity="0.6"/>
        <circle cx="38" cy="26" r="3" fill="#ffb3b3" opacity="0.5"/>
        <path d="M28 24 C30 28,34 28,36 24" stroke="#ffb3b3" stroke-width="2" fill="none" opacity="0.4"/>
      `);
    }
    function decor_moon(){
      return wrapDecor(`
        <path d="M32 14 C21 14,12 23,12 34 C12 45,21 54,32 54 C36 54,40 53,43 51 C35 48,29 42,29 34 C29 26,35 20,43 17 C40 15,36 14,32 14Z"
              fill="#fff4cc" stroke="#ffe680" stroke-width="2.5" stroke-linejoin="round" opacity="0.92"/>
        <ellipse cx="26" cy="26" rx="4" ry="5" fill="#fffae6" opacity="0.6"/>
        <circle cx="27" cy="30" r="2.5" fill="#f4e8b3" opacity="0.35"/>
        <circle cx="25" cy="40" r="2" fill="#f4e8b3" opacity="0.35"/>
        <circle cx="30" cy="36" r="1.5" fill="#f4e8b3" opacity="0.3"/>
      `);
    }

function decor_candy(){
  return wrapDecor(`
    <g>
      <!-- ç™½è‰²ç³–èº« -->
      <path d="M38 16
               C48 16 50 28 42 34
               C36 38 30 34 30 28
               C30 22 34 20 38 20
               L38 54"
            fill="none"
            stroke="#ffffff"
            stroke-width="8"
            stroke-linecap="round"
            stroke-linejoin="round"/>

      <!-- ç´…è‰²å¤–æ -->
      <path d="M38 16
               C48 16 50 28 42 34
               C36 38 30 34 30 28
               C30 22 34 20 38 20
               L38 54"
            fill="none"
            stroke="rgba(0,0,0,.18)"
            stroke-width="2.6"
            stroke-linecap="round"
            stroke-linejoin="round"/>

      <!-- ç´…è‰²æ¢ç´‹ï¼ˆçŸ­å¼§ç·šï¼Œæ’ç•«æ„Ÿï¼‰ -->
      ${[26, 32, 38, 44, 50].map(y=>`
        <path d="M34 ${y} C38 ${y-2},40 ${y-2},44 ${y}"
              fill="none"
              stroke="#d6453d"
              stroke-width="3"
              stroke-linecap="round"
              opacity="0.95"/>
      `).join('')}

      <!-- ä¸Šæ–¹å‹¾å‹¾çš„ç´…æ¢ç´‹ -->
      <path d="M40 20 C44 20,46 24,44 28"
            fill="none"
            stroke="#d6453d"
            stroke-width="3"
            stroke-linecap="round"
            opacity="0.95"/>
    </g>
  `);
}
    
    // === æ›´å¤šè´è¶çµæ¬¾å¼ï¼ˆåƒè€ƒåœ–ç‰‡é¢¨æ ¼ï¼‰===
function bowShape(fill){
  // è´è¶çµæœ¬é«”ï¼ˆä¸å«ç™½é‚Šï¼‰
  return `
    <!-- å·¦ç¿… -->
    <path d="M32 24 C18 10 6 16 8 30 C10 42 22 42 32 32 Z" fill="${fill}"/>
    <!-- å³ç¿… -->
    <path d="M32 24 C46 10 58 16 56 30 C54 42 42 42 32 32 Z" fill="${fill}"/>
    <!-- ä¸­å¿ƒçµ -->
    <ellipse cx="32" cy="30" rx="6" ry="5" fill="${fill}"/>
    <!-- å·¦é•·å°¾ -->
    <path d="M28 34 C20 46 18 56 22 64 L30 64 C28 56 30 46 34 38 Z" fill="${fill}"/>
    <!-- å³é•·å°¾ -->
    <path d="M36 34 C44 46 46 56 42 64 L34 64 C36 56 34 46 30 38 Z" fill="${fill}"/>
  `;
}

// ç™½é‚Šæ•ˆæœï¼šå…ˆç•«ç™½è‰²å¤§ä¸€é»ï¼Œå†ç•«å…§å±¤è‰²å°ä¸€é»
// æ°´å½©æ‰‹ç¹ªè´è¶çµï¼ˆç„¡å¤–æ¡†/ç„¡æé‚Šï¼‰ï¼šç”¨ä¸€å±¤è¼•å¾®æ¨¡ç³Šç–Šè‰² + å…§å±¤é™°å½± + é¡†ç²’è³ªæ„Ÿ
function bowWatercolor(main="#e35b6a", shade="#d84a5a"){
  return `
    <g>
      <!-- æŸ”åŒ–å¤–ç·£ï¼šåŒè‰²è¼•å¾®æ¨¡ç³Šç–Šä¸€å±¤ï¼ˆä¸æœƒæœ‰åŒ¡é‚Šï¼‰ -->
      <g filter="url(#softBlur)" opacity="0.35">
        ${bowShape(main)}
      </g>

      <!-- ä¸»é«” -->
      ${bowShape(main)}

      <!-- å…§å±¤æ°´å½©é™°å½±/ç­†è§¸ -->
      <g opacity="0.22">
        <ellipse cx="24" cy="26" rx="7" ry="4" fill="${shade}"/>
        <ellipse cx="42" cy="26" rx="7" ry="4" fill="${shade}"/>
        <ellipse cx="28" cy="54" rx="7" ry="10" fill="${shade}"/>
        <ellipse cx="36" cy="54" rx="7" ry="10" fill="${shade}"/>
      </g>

      <!-- æ°´å½©äº®é¢ï¼ˆä¸æé‚Šï¼‰ -->
      <g opacity="0.18">
        <path d="M18 22 C22 16 28 16 31 21 C28 23 24 24 18 22 Z" fill="#fff"/>
        <path d="M46 22 C42 16 36 16 33 21 C36 23 40 24 46 22 Z" fill="#fff"/>
      </g>

      <!-- ç´™æ„Ÿé¡†ç²’ -->
      <g opacity="0.10">
        <circle cx="22" cy="40" r="1.3" fill="#fff"/>
        <circle cx="40" cy="44" r="1.1" fill="#fff"/>
        <circle cx="30" cy="52" r="1.2" fill="#fff"/>
        <circle cx="36" cy="36" r="0.9" fill="#fff"/>
      </g>
    </g>
  `;
}


function decor_bowCreamStripe(){
  // 1) çµ±ä¸€æˆã€Œæ‰‹ç¹ªæ°´å½©ã€ï¼šç²‰ç´…åº• + æ·¡æ·¡æ°´å½©æ¢ç´‹ï¼ˆç„¡æé‚Šï¼‰
  return wrapDecor(`
    <g transform="translate(0,-1)">
      ${bowWatercolor("#f39aa6","#d85e6f")}

      <!-- æ·¡æ°´å½©æ¢ç´‹ï¼ˆåƒåˆ·ç—•ï¼Œä¸æ˜¯æ ¼ç´‹ï¼‰ -->
      <g opacity="0.12">
        <rect x="18" y="16" width="4.5" height="42" rx="2.2" fill="#fff"/>
        <rect x="28" y="14" width="4.2" height="44" rx="2.1" fill="#fff"/>
        <rect x="38" y="16" width="4.5" height="42" rx="2.2" fill="#fff"/>
      </g>
    </g>
  `);
}

function decor_bowGreenDots(){
  // 2) çµ±ä¸€æˆã€Œæ‰‹ç¹ªæ°´å½©ã€ï¼šæ·¡ç¶ åº• + æ°´å½©åœ“é»ï¼ˆç„¡æé‚Šï¼‰
  return wrapDecor(`
    ${bowWatercolor("#b8d7a8","#8fbf85")}
    <g opacity="0.45">
      ${[
        [18,22],[26,20],[46,24],[40,22],[22,40],[44,44],[28,52],[38,54]
      ].map(([x,y])=>`<circle cx="${x}" cy="${y}" r="2.2" fill="#4e7f67"/>`).join('')}
    </g>
  `);
}

function decor_bowBurgundyFloral(){
  return wrapDecor(`
    ${bowWatercolor("#8f2337","#6f1b2a")}
    <g opacity="0.55">
      ${[
        [20,22],[46,24],[26,58],[40,56]
      ].map(([x,y])=>`
        <g transform="translate(${x} ${y})">
          <circle cx="0" cy="0" r="2.2" fill="#f2a3b3"/>
          <circle cx="-2" cy="0" r="1.2" fill="#f2a3b3"/>
          <circle cx="2" cy="0" r="1.2" fill="#f2a3b3"/>
          <circle cx="0" cy="-2" r="1.2" fill="#f2a3b3"/>
          <circle cx="0" cy="2" r="1.2" fill="#f2a3b3"/>
        </g>
      `).join('')}
    </g>
  `);
}

function decor_bowYellow(){
  // é»ƒè‰²æ‰‹ç¹ªæ°´å½©ï¼ˆç„¡å¤–æ¡†/ç„¡æé‚Šï¼‰
  return wrapDecor(`
    ${bowWatercolor("#f4d06a","#e6b93c")}
    <g opacity="0.16">
      <circle cx="22" cy="28" r="2.0" fill="#fff"/>
      <circle cx="44" cy="30" r="1.6" fill="#fff"/>
    </g>
  `);
}

function decor_bowRedBig(){
  return wrapDecor(`
    <g transform="translate(0,-2) scale(1.08) translate(-2,0)">
      ${bowWatercolor("#d83a3a","#b92f2f")}
    </g>
  `);
}

function decor_bowBlueSoft(){
  return wrapDecor(`
    ${bowWatercolor("#b9d2dc","#95b8c7")}
  `);
}

function decor_bowPinkRibbon(){
  return wrapDecor(`
    ${bowWatercolor("#f2a3c2","#df7ea7")}
    <g opacity="0.35">
      <path d="M16 22 C22 18 26 18 30 22" fill="#fff"/>
      <path d="M48 22 C42 18 38 18 34 22" fill="#fff"/>
    </g>
  `);
}

function decor_bowPlaid(){
  // 7) æ”¹æˆã€Œé»ƒè‰²æ‰‹ç¹ªæ°´å½©è´è¶çµã€ï¼šä¸è¦æ ¼ç´‹ï¼ˆç„¡æé‚Šï¼‰
  return wrapDecor(`
    ${bowWatercolor("#f4d06a","#e6b93c")}
    <!-- å°äº®é¢/æ°´å½©æšˆæŸ“ -->
    <g opacity="0.14">
      <path d="M20 24 C23 20 27 20 30 24 C27 26 23 26 20 24 Z" fill="#fff"/>
      <path d="M44 24 C41 20 37 20 34 24 C37 26 41 26 44 24 Z" fill="#fff"/>
    </g>
  `);
}

function decor_bowTinyRed(){
  // å°è´è¶çµï¼ˆçŸ­å°¾ï¼‰ï¼šçµ±ä¸€æˆæ‰‹ç¹ªæ°´å½©é¢¨ã€ç„¡å¤–æ¡†
  return wrapDecor(`
    <g transform="translate(0,6) scale(0.9)">
      <g filter="url(#softBlur)" opacity="0.30">
        <path d="M32 24 C18 10 6 16 8 30 C10 42 22 42 32 32 Z" fill="#c93f3a"/>
        <path d="M32 24 C46 10 58 16 56 30 C54 42 42 42 32 32 Z" fill="#c93f3a"/>
        <ellipse cx="32" cy="30" rx="6" ry="5" fill="#c93f3a"/>
      </g>

      <path d="M32 24 C18 10 6 16 8 30 C10 42 22 42 32 32 Z" fill="#c93f3a"/>
      <path d="M32 24 C46 10 58 16 56 30 C54 42 42 42 32 32 Z" fill="#c93f3a"/>
      <ellipse cx="32" cy="30" rx="6" ry="5" fill="#c93f3a"/>

      <g opacity="0.20">
        <ellipse cx="24" cy="25.8" rx="5.4" ry="3.2" fill="#a8322e"/>
        <ellipse cx="40" cy="25.8" rx="5.4" ry="3.2" fill="#a8322e"/>
      </g>

      <g opacity="0.16">
        <path d="M20 22 C23 18 27 18 29.5 21.5 C27 23 23 23.5 20 22 Z" fill="#fff"/>
        <path d="M44 22 C41 18 37 18 34.5 21.5 C37 23 41 23.5 44 22 Z" fill="#fff"/>
      </g>

      <g opacity="0.10">
        <circle cx="26" cy="34" r="1.1" fill="#fff"/>
        <circle cx="38" cy="36" r="1.0" fill="#fff"/>
      </g>
    </g>
  `);
}


    
    // === æ›´å¤šè¥ªå­æ¬¾å¼ ===


/* å°å·¥å…·ï¼šç°¡åŒ–é›ªèŠ± */
function decor_sock_snow(){
  return wrapDecor(`
    ${stockingBase("#c93f3a", "#a93430")}

    ${[24,32,40,30,38].map((x,i)=>`
      <g transform="translate(${x} ${34+i*3}) scale(0.6)">
        <path d="M8 0 L8 16 M0 8 L16 8 M3 3 L13 13 M13 3 L3 13"
          stroke="#fff" stroke-width="2" stroke-linecap="round"/>
      </g>
    `).join('')}
  `);
}


function decor_sock_stripe(){
  return wrapDecor(`
    ${stockingBase("#2f7f5f", "#1f5f45")}

    ${[28,34,40,46].map(y=>`
      <rect x="18" y="${y}" width="34" height="4"
        rx="2" fill="#c93f3a" opacity=".9"/>
    `).join('')}
  `);
}
function decor_sock_dots(){
  return wrapDecor(`
    ${stockingBase("#c93f3a", "#a93430")}

    ${[
      [26,34],[34,40],[42,34],[30,46],[40,48]
    ].map(p=>`
      <circle cx="${p[0]}" cy="${p[1]}" r="3.2" fill="#fff"/>
    `).join('')}
  `);
}
function decor_sock_tree(){
  return wrapDecor(`
    ${stockingBase("#e8dccb", "#cbb9a5")}

    <path d="M36 30 L30 40 L34 40 L28 50 L44 50 L38 40 L42 40 Z"
      fill="#3a8f5b"/>

    <rect x="34" y="50" width="4" height="6" rx="1" fill="#6b4a2d"/>
  `);
}
function decor_sock_fuzzy(){
  return wrapDecor(`
    ${stockingBase("#f3b6c4", "#eaa2b3")}

    <path d="M22 28 Q32 30 42 28"
      stroke="rgba(255,255,255,.5)"
      stroke-width="3"
      stroke-linecap="round"/>

    <path d="M22 36 Q34 38 46 36"
      stroke="rgba(255,255,255,.35)"
      stroke-width="3"
      stroke-linecap="round"/>
  `);
}
function decor_sock_winter(){
  return wrapDecor(`
    ${stockingBase("#9fb3c8", "#7f93a8")}

    ${[30,38,46].map(y=>`
      <path d="M22 ${y} Q34 ${y+2} 46 ${y}"
        stroke="#fff"
        stroke-width="2.5"
        stroke-linecap="round"
        opacity=".6"/>
    `).join('')}
  `);
}
function stockingBase(fill="#c93f3a", cuff="#a93430"){
  return `
    <!-- è¥ªå£ -->
    <path d="
      M18 10 Q18 7 21 7
      L49 7 Q52 7 52 10
      L52 21 Q52 24 49 24
      L21 24 Q18 24 18 21 Z"
      fill="${cuff}"/>

    <!-- è¥ªèº« -->
    <path d="
      M22 24 L48 24 L48 40
      Q48 46 53 47
      Q58 48 58 53
      Q58 58 52 58
      L24 58
      Q18 58 18 52
      L18 30
      Q18 26 22 24 Z"
      fill="${fill}"/>

    <!-- è…³èƒŒå¼§ç·š -->
    <path d="M48 40 Q44 44 36 44 Q28 44 22 41"
      fill="none"
      stroke="rgba(0,0,0,.12)"
      stroke-width="3"
      stroke-linecap="round"/>
  `;
}
    // === å…¶ä»–æ–°å…ƒç´  ===
    function decor_gingerbread(){
      return wrapDecor(`
        <!-- è–‘é¤…äºº -->
        <circle cx="32" cy="24" r="8" fill="#d9a574" stroke="#c9957a" stroke-width="2.5" opacity="0.95"/>
        <ellipse cx="32" cy="38" rx="10" ry="12" fill="#d9a574" stroke="#c9957a" stroke-width="2.5" opacity="0.95"/>
        <!-- æ‰‹è‡‚ -->
        <ellipse cx="20" cy="36" rx="4" ry="8" fill="#d9a574" stroke="#c9957a" stroke-width="2.5" opacity="0.95" transform="rotate(-30 20 36)"/>
        <ellipse cx="44" cy="36" rx="4" ry="8" fill="#d9a574" stroke="#c9957a" stroke-width="2.5" opacity="0.95" transform="rotate(30 44 36)"/>
        <!-- è…¿ -->
        <ellipse cx="27" cy="52" rx="4" ry="7" fill="#d9a574" stroke="#c9957a" stroke-width="2.5" opacity="0.95"/>
        <ellipse cx="37" cy="52" rx="4" ry="7" fill="#d9a574" stroke="#c9957a" stroke-width="2.5" opacity="0.95"/>
        <!-- è‡‰éƒ¨ -->
        <circle cx="28" cy="22" r="1.5" fill="#5a4a3a"/>
        <circle cx="36" cy="22" r="1.5" fill="#5a4a3a"/>
        <path d="M28 26 Q32 28 36 26" stroke="#5a4a3a" stroke-width="2" fill="none" stroke-linecap="round"/>
        <!-- è£é£¾ -->
        <circle cx="32" cy="34" r="2" fill="#ff8888" opacity="0.8"/>
        <circle cx="32" cy="40" r="2" fill="#ff8888" opacity="0.8"/>
        <circle cx="32" cy="46" r="2" fill="#ff8888" opacity="0.8"/>
        <!-- é‹¸é½’æ³¢æµªé‚Š -->
        <path d="M26 50 Q28 48 30 50" stroke="#ffffff" stroke-width="2" fill="none" opacity="0.7"/>
        <path d="M34 50 Q36 48 38 50" stroke="#ffffff" stroke-width="2" fill="none" opacity="0.7"/>
      `);
    }
    
    function decor_gift2(){
      return wrapDecor(`
        <!-- ç¶ è‰²ç¦®ç‰©ç›’ -->
        <rect x="18" y="30" width="28" height="24" rx="3" fill="#7dd9a3" stroke="#66cc8f" stroke-width="2.5" opacity="0.92"/>
        <rect x="16" y="26" width="32" height="6" rx="2" fill="#5ab887" stroke="#4da876" stroke-width="2.5" opacity="0.92"/>
        <!-- ç·å¸¶ -->
        <rect x="30" y="26" width="4" height="28" fill="#ff8888" opacity="0.9"/>
        <rect x="16" y="40" width="32" height="4" fill="#ff8888" opacity="0.9"/>
        <!-- è´è¶çµ -->
        <path d="M24 22 C22 20,22 18,24 16 C26 14,28 16,28 18 L32 18 C32 16,34 14,36 16 C38 18,38 20,36 22 Z"
              fill="#ff9999" stroke="#ff8888" stroke-width="2" opacity="0.92"/>
        <circle cx="32" cy="22" r="3" fill="#ff8888" opacity="0.9"/>
        <circle cx="24" cy="38" r="2" fill="#ffffff" opacity="0.6"/>
      `);
    }
    
    function decor_holly(){
      return wrapDecor(`
        <!-- å†¬é’è‘‰ -->
        <path d="M20 32 C16 28,16 24,20 22 C22 21,24 22,25 24 C26 22,28 21,30 22 C34 24,34 28,30 32 C28 33,26 32,25 30 C24 32,22 33,20 32 Z"
              fill="#5ab887" stroke="#4da876" stroke-width="2" opacity="0.92"/>
        <path d="M34 32 C30 28,30 24,34 22 C36 21,38 22,39 24 C40 22,42 21,44 22 C48 24,48 28,44 32 C42 33,40 32,39 30 C38 32,36 33,34 32 Z"
              fill="#5ab887" stroke="#4da876" stroke-width="2" opacity="0.92"/>
        <!-- ç´…è‰²æœå¯¦ -->
        <circle cx="28" cy="38" r="3.5" fill="#ff6666" stroke="#ff5555" stroke-width="2" opacity="0.95"/>
        <circle cx="36" cy="38" r="3.5" fill="#ff6666" stroke="#ff5555" stroke-width="2" opacity="0.95"/>
        <circle cx="32" cy="42" r="3.5" fill="#ff6666" stroke="#ff5555" stroke-width="2" opacity="0.95"/>
        <ellipse cx="26" cy="37" rx="1.5" ry="2" fill="#ff9999" opacity="0.6"/>
        <ellipse cx="34" cy="37" rx="1.5" ry="2" fill="#ff9999" opacity="0.6"/>
      `);
    }

/* =========================
   STAR PACK (BIG + SAFE)
========================= */

// â­ çµ±ä¸€ï¼šæ¨¹é ‚æ˜Ÿæ˜Ÿçš„ transformï¼ˆæ›´å¤§ä¸€é»ï¼‰
function STAR_T(scale = 1.15){
  // åŸæœ¬æ˜Ÿæ˜Ÿåœ¨ (260,120)ï¼›æƒ³æ›´å¤§å°±èª¿ scale
  return `translate(260 78) scale(1.75)`;
}

// åŸºæœ¬æ˜Ÿå½¢è·¯å¾‘ï¼ˆä¿®æ­£ï¼šæ¯å€‹åº§æ¨™è¦æœ‰ç©ºæ ¼ï¼Œä¸” M å¾Œé¢è¦ç©ºæ ¼ï¼‰
function starPath(){
  return `M 0 -32 L 10 -8 L 36 -8 L 15 6 L 24 30 L 0 15 L -24 30 L -15 6 L -36 -8 L -10 -8 Z`;
}

// æ°´å½©é¡†ç²’é»ï¼ˆæ›´æŸ”å’Œï¼‰
function speckles(color="#fff", opacity=0.12){
  return `
    <g opacity="${opacity}">
      <circle cx="-11" cy="-10" r="2.0" fill="${color}"/>
      <circle cx="13"  cy="-7"  r="1.6" fill="${color}"/>
      <circle cx="-2"  cy="8"   r="1.8" fill="${color}"/>
      <circle cx="8"   cy="14"  r="1.4" fill="${color}"/>
      <circle cx="-14" cy="10"  r="1.2" fill="${color}"/>
      <circle cx="2"   cy="-2"  r="1.2" fill="${color}"/>
    </g>
  `;
}

// è®“ clipPath id æ¯æ¬¡éƒ½ä¸æ’åï¼ˆå¾ˆé‡è¦ï¼‰
function uid(prefix="id"){
  return `${prefix}_${Math.random().toString(16).slice(2)}_${Date.now()}`;
}

/* 1) æ°´å½©é‡‘æ˜Ÿï¼ˆæŸ”å’Œï¼‰ */
function starSVG_WaterGold(){
  return `
    <g transform="${STAR_T(1.18)}">
      <path d="${starPath()}" fill="#f6d56b" opacity="0.92"/>
      <path d="${starPath()}" fill="#fff4cc" opacity="0.22" transform="translate(-2,-2)"/>
      <circle cx="0" cy="0" r="7.5" fill="#fde68a" opacity="0.85"/>
      ${speckles("#fff", 0.14)}
    </g>`;
}

/* 2) æ°´å½©é‡‘ç²‰æ˜Ÿï¼ˆç²‰å«©ï¼‰ */
function starSVG_WaterPink(){
  return `
    <g transform="${STAR_T(1.18)}">
      <path d="${starPath()}" fill="#ffb3c6" opacity="0.90"/>
      <path d="${starPath()}" fill="#ffd6e5" opacity="0.30" transform="translate(-2,-2)"/>
      <circle cx="0" cy="0" r="7.5" fill="#ff8fab" opacity="0.78"/>
      ${speckles("#fff", 0.12)}
    </g>`;
}

function starSVG_WaterBlue(){
  return `
    <g transform="${STAR_T(1.18)}">
      <path d="${starPath()}" fill="#7dd3fc" opacity="0.92"/>
      <path d="${starPath()}" fill="#e0f2fe" opacity="0.22" transform="translate(-2,-2)"/>
      <circle cx="0" cy="0" r="7.5" fill="#bae6fd" opacity="0.85"/>
      ${speckles("#fff", 0.14)}
    </g>`;
}

function starSVG_WaterMint(){
  return `
    <g transform="${STAR_T(1.18)}">
      <path d="${starPath()}" fill="#a7f3d0" opacity="0.92"/>
      <path d="${starPath()}" fill="#ecfdf5" opacity="0.22" transform="translate(-2,-2)"/>
      <circle cx="0" cy="0" r="7.5" fill="#6ee7b7" opacity="0.78"/>
      ${speckles("#fff", 0.14)}
    </g>`;
}

function starSVG_WaterSilver(){
  return `
    <g transform="${STAR_T(1.18)}">
      <path d="${starPath()}" fill="#e5e7eb" opacity="0.92"/>
      <path d="${starPath()}" fill="#ffffff" opacity="0.20" transform="translate(-2,-2)"/>
      <circle cx="0" cy="0" r="7.5" fill="#f3f4f6" opacity="0.85"/>
      ${speckles("#fff", 0.16)}
    </g>`;
}

/* 3) è–„è·ç³–æ—‹ç´‹æ˜Ÿï¼ˆç³–æœï¼‰ */
function starSVG_Peppermint(){
  const clipId = uid("clipStarPep");
  return `
    <g transform="${STAR_T(1.15)}">
      <path d="${starPath()}" fill="#ffffff" opacity="0.92"/>
      <defs>
        <clipPath id="${clipId}">
          <path d="${starPath()}"/>
        </clipPath>
      </defs>

      <g clip-path="url(#${clipId})" opacity="0.75">
        ${Array.from({length:9}).map((_,i)=>`
          <path d="M -70 ${-45+i*12} L 70 ${-35+i*12} L 70 ${-22+i*12} L -70 ${-32+i*12} Z"
                fill="${i%2===0?'#ef4444':'#7dd3fc'}" opacity="0.55"/>
        `).join('')}
      </g>

      <circle cx="0" cy="0" r="7.2" fill="#fca5a5" opacity="0.55"/>
      <path d="${starPath()}" fill="none" stroke="rgba(0,0,0,.10)" stroke-width="3" opacity="0.25" stroke-linejoin="round"/>
    </g>`;
}

/* 4) åŒ—æ¥µæ˜Ÿï¼ˆå°–å°–é•·é•·ã€æ¯”è¼ƒé–ƒï¼‰ */
function starSVG_North(){
  const north = `M 0 -40 L 8 -10 L 40 -10 L 12 6 L 22 38 L 0 18 L -22 38 L -12 6 L -40 -10 L -8 -10 Z`;
  return `
    <g transform="${STAR_T(1.08)}">
      <path d="${north}" fill="#fde68a" opacity="0.92"/>
      <path d="M 0 -40 L 8 -10 L 0 0 L -8 -10 Z" fill="#fff4cc" opacity="0.80"/>
      <circle cx="0" cy="0" r="7" fill="#ffffff" opacity="0.18"/>
      ${speckles("#fff", 0.16)}
    </g>`;
}

/* 5) é›ªèŠ±æ˜Ÿï¼ˆä¿®æ­£ï¼šæ¯å€‹ path éƒ½è¦ M é–‹é ­ï¼‰ */
function starSVG_Snowflake(){
  return `
    <g transform="${STAR_T(1.18)}">
      <path d="${starPath()}" fill="#b9d2dc" opacity="0.92"/>
      <path d="${starPath()}" fill="#e6f2ff" opacity="0.28" transform="translate(-2,-2)"/>

      <g opacity="0.75">
        <path d="M 0 -14 L 0 14" stroke="#fff" stroke-width="4" stroke-linecap="round"/>
        <path d="M -14 0 L 14 0" stroke="#fff" stroke-width="4" stroke-linecap="round"/>
        <path d="M -10 -10 L 10 10" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
        <path d="M 10 -10 L -10 10" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
      </g>

      ${speckles("#fff", 0.12)}
    </g>`;
}

/* 6) 3D é‡‘æ˜Ÿï¼ˆç«‹é«”åˆ‡é¢ï¼‰ */
function starSVG_3DGoldBig(){
  return `
    <g transform="${STAR_T(1.22)}">
      <path d="${starPath()}" fill="#fbbf24" opacity="0.93"/>
      <path d="M 0 -32 L 10 -8 L 0 0 L -10 -8 Z" fill="#fde68a" opacity="0.86"/>
      <path d="M 10 -8 L 36 -8 L 15 6 L 0 0 Z" fill="#fef3c7" opacity="0.92"/>
      <path d="M 15 6 L 24 30 L 0 15 L 0 0 Z" fill="#fff4cc" opacity="0.86"/>
      <path d="M 0 15 L -24 30 L -15 6 L 0 0 Z" fill="#fde68a" opacity="0.88"/>
      <path d="M -15 6 L -36 -8 L -10 -8 L 0 0 Z" fill="#fcd34d" opacity="0.88"/>
      ${speckles("#fff", 0.10)}
    </g>`;
}

/* 7) é–ƒäº®æ˜Ÿï¼ˆå¤–åœå…‰èŠ’ï¼‰ */
function starSVG_Glow(){
  return `
    <g transform="${STAR_T(1.18)}">
      <path d="${starPath()}" fill="#fef08a" opacity="0.92"/>
      <circle cx="0" cy="0" r="24" fill="#fde68a" opacity="0.14"/>
      <circle cx="0" cy="0" r="34" fill="#fde68a" opacity="0.08"/>
      <circle cx="0" cy="0" r="8"  fill="#fff" opacity="0.16"/>
      ${speckles("#fff", 0.20)}
    </g>`;
}

function bowSoftBase2(fill="#ff8fab", knot="#fff", tail="#ffb3c6"){
  return `
    <g opacity="0.95">
      <!-- å·¦ç¿…ï¼ˆæ›´åœ“ï¼‰ -->
      <path d="M0 0
               C-10 -10,-28 -10,-30 4
               C-32 18,-14 18,-4 8 Z"
            fill="${fill}" />
      <!-- å³ç¿… -->
      <path d="M0 0
               C10 -10,28 -10,30 4
               C32 18,14 18,4 8 Z"
            fill="${fill}" />

      <!-- ä¸­å¿ƒçµ -->
      <ellipse cx="0" cy="5" rx="6" ry="5" fill="${knot}" opacity="0.9"/>

      <!-- å·¦å°¾ï¼ˆçŸ­ä¸€é»ä¸æœƒç©¿åˆ°æ¨¹è£¡ï¼‰ -->
      <path d="M-6 12
               C-12 26,-10 40,-4 52
               C-2 44,0 30,2 16 Z"
            fill="${tail}" opacity="0.9"/>

      <!-- å³å°¾ -->
      <path d="M6 12
               C12 26,10 40,4 52
               C2 44,0 30,-2 16 Z"
            fill="${tail}" opacity="0.9"/>

      <!-- ä¸€é»é«˜å…‰ -->
      <path d="M-18 2 C-14 -4,-10 -6,-6 -4" stroke="#fff" stroke-width="2.5" opacity="0.25" fill="none" stroke-linecap="round"/>
      <path d="M18 2 C14 -4,10 -6,6 -4" stroke="#fff" stroke-width="2.5" opacity="0.25" fill="none" stroke-linecap="round"/>
    </g>
  `;
}

function topBow_Pink(){
  return `
    <g transform="${STAR_T(1.45)}">
      <g transform="translate(0,8)">
        ${bowSoftBase2("#ff8fab","#fff","#ffb3c6")}
      </g>
      ${speckles("#fff",0.14)}
    </g>`;
}

function topBow_Cream(){
  return `
    <g transform="${STAR_T(1.45)}">
      <g transform="translate(0,8)">
        ${bowSoftBase2("#f5d0c5","#fff","#fff4cc")}
      </g>
      ${speckles("#fff",0.16)}
    </g>`;
}

function topBow_Velvet(){
  return `
    <g transform="${STAR_T(1.45)}">
      <g transform="translate(0,8)">
        ${bowSoftBase2("#c93f3a","#fff","#e86a61")}
      </g>
      ${speckles("#fff",0.10)}
    </g>`;
}

function topBow_Double(){
  return `
    <g transform="${STAR_T(1.45)}">
      <g transform="translate(0,8) scale(1.05)">
        ${bowSoftBase2("#ff8fab","#fff","#ffb3c6")}
      </g>
      <g transform="translate(0,10) scale(0.72)" opacity="0.85">
        ${bowSoftBase2("#fff","#fff","#ffe4ee")}
      </g>
      ${speckles("#fff",0.16)}
    </g>`;
}

function topBow_Mini(){
  return `
    <g transform="${STAR_T(1.35)}">
      <g transform="translate(0,10) scale(0.78)">
        ${bowSoftBase2("#ff8fab","#fff","#ffd6e5")}
      </g>
      ${speckles("#fff",0.12)}
    </g>`;
}

function clientToSvg(svgEl, clientX, clientY){
  const pt = svgEl.createSVGPoint();
  pt.x = clientX;
  pt.y = clientY;
  const ctm = svgEl.getScreenCTM();
  if (!ctm) return { x: 0, y: 0 };
  const p = pt.matrixTransform(ctm.inverse());
  return { x: p.x, y: p.y };
}
function safeNum(n, fallback=0){
  n = Number(n);
  return Number.isFinite(n) ? n : fallback;
}

// render ornaments
const ornamentsSvg = ornaments.map(o => {
  const x = safeNum(o.x);
  const y = safeNum(o.y);
  const s = safeNum(o.scale, 1);

  return `
    <g class="orn" data-id="${o.id}"
       transform="translate(${x} ${y}) scale(${s})">
      ${o.svg}
    </g>
  `;
}).join('');
// âœ… æ”¾åœ¨æœ€ä¸Šé¢ï¼ˆå…¨æª”åªè¦ä¸€ä»½ï¼‰
// é‡è¦ï¼šè£é£¾ SVG ä¸è¦è‡ªå·±å®šä½ (ä¸è¦ translate åˆ°ç•«å¸ƒå·¦ä¸Š)ï¼›
// ä½ç½®ç”±å¤–å±¤ renderTree çš„ translate(x,y) æ±ºå®šã€‚
function TOP_T(scale=1){
  return `scale(${scale})`;
}

// å°é¡†ç²’ï¼ˆå¯ç•™å¯ä¸ç•™ï¼‰
function specklesSoft(color="#fff", opacity=0.10){
  return `
    <g opacity="${opacity}">
      <circle cx="-12" cy="-8" r="1.6" fill="${color}"/>
      <circle cx="10"  cy="-6" r="1.2" fill="${color}"/>
      <circle cx="-2"  cy="10" r="1.4" fill="${color}"/>
      <circle cx="8"   cy="16" r="1.0" fill="${color}"/>
      <circle cx="-16" cy="12" r="0.9" fill="${color}"/>
    </g>
  `;
}

/**
 * A) ç·å¸¶æŸ”å…‰ï¼ˆäº®é¢ã€æ›²ç·šå°¾å·´ï¼‰
 * æ³¨æ„ï¼šä¸è‡ªå¸¶ translate/scaleï¼Œå¤–å±¤æ±ºå®šä½ç½®å¤§å°
 */
function bowSVG_RibbonGlossy({fill="#e11d48", hi="#ffd1dc", knot="#ff7aa2"} = {}){
  return `
    <g opacity="0.98">
      <!-- loops -->
      <path d="M0 0
               C-10 -14,-34 -16,-40 2
               C-46 22,-22 22,-8 10
               C-3 6,-2 2,0 0 Z" fill="${fill}"/>
      <path d="M0 0
               C10 -14,34 -16,40 2
               C46 22,22 22,8 10
               C3 6,2 2,0 0 Z" fill="${fill}"/>

      <!-- tails (wavy) -->
      <path d="M-6 14
               C-20 30,-26 48,-18 64
               C-10 54,-8 40,-2 22
               C-1 18,-3 15,-6 14 Z" fill="${fill}" opacity="0.95"/>
      <path d="M6 14
               C20 30,26 48,18 64
               C10 54,8 40,2 22
               C1 18,3 15,6 14 Z" fill="${fill}" opacity="0.95"/>

      <!-- knot -->
      <ellipse cx="0" cy="6" rx="7.5" ry="6.2" fill="${knot}" opacity="0.95"/>

      <!-- glossy highlights -->
      <path d="M-30 4 C-24 -6,-14 -10,-10 -6" stroke="${hi}" stroke-width="3" opacity="0.40" fill="none" stroke-linecap="round"/>
      <path d="M30 4  C24 -6,14 -10,10 -6"  stroke="${hi}" stroke-width="3" opacity="0.40" fill="none" stroke-linecap="round"/>
      <path d="M-16 34 C-18 42,-16 50,-10 54" stroke="${hi}" stroke-width="2.4" opacity="0.22" fill="none" stroke-linecap="round"/>
      <path d="M16 34  C18 42,16 50,10 54"  stroke="${hi}" stroke-width="2.4" opacity="0.22" fill="none" stroke-linecap="round"/>

      ${specklesSoft("#fff",0.08)}
    </g>
  `;
}

/**
 * B) å¤©éµçµ¨é•·å‚ï¼ˆåšã€ç›´å‚ã€å°¾ç«¯åˆ‡è§’ï¼‰
 */
function bowSVG_VelvetLong({fill="#991b1b", hi="#ffd6d6", knot="#b91c1c"} = {}){
  return `
    <g opacity="0.98">
      <!-- loops (more rectangular) -->
      <path d="M0 0
               C-10 -10,-34 -12,-42 2
               C-46 14,-36 24,-16 16
               C-8 12,-4 6,0 0 Z" fill="${fill}"/>
      <path d="M0 0
               C10 -10,34 -12,42 2
               C46 14,36 24,16 16
               C8 12,4 6,0 0 Z" fill="${fill}"/>

      <!-- tails (straight) -->
      <path d="M-10 16 L-26 72 L-8 72 L4 22 Z" fill="${fill}" opacity="0.96"/>
      <path d="M10 16  L26 72  L8 72  L-4 22 Z" fill="${fill}" opacity="0.96"/>
      <!-- tail cuts -->
      <path d="M-26 72 L-17 82 L-8 72 Z" fill="${fill}" opacity="0.96"/>
      <path d="M26 72  L17 82  L8 72 Z" fill="${fill}" opacity="0.96"/>

      <!-- knot -->
      <rect x="-8" y="0" width="16" height="16" rx="4" fill="${knot}" opacity="0.95"/>

      <!-- velvet shading -->
      <path d="M-30 6 C-24 0,-18 -2,-14 2" stroke="${hi}" stroke-width="2.6" opacity="0.18" fill="none" stroke-linecap="round"/>
      <path d="M30 6  C24 0,18 -2,14 2"  stroke="${hi}" stroke-width="2.6" opacity="0.18" fill="none" stroke-linecap="round"/>
      <path d="M-18 30 C-22 44,-20 56,-16 66" stroke="${hi}" stroke-width="2.2" opacity="0.10" fill="none" stroke-linecap="round"/>
      <path d="M18 30  C22 44,20 56,16 66"  stroke="${hi}" stroke-width="2.2" opacity="0.10" fill="none" stroke-linecap="round"/>

      ${specklesSoft("#fff",0.06)}
    </g>
  `;
}

function bowSVG_Sheer({fill="#f7a8c6", shade="#ee86b3", hi="#fff3f7", knot="#f39bbf"} = {}){
  return `
    <g>
      <!-- base loops -->
      <path d="M0 0
               C-10 -12,-34 -14,-42 3
               C-48 18,-34 26,-14 16
               C-6 12,-3 6,0 0 Z" fill="${fill}"/>
      <path d="M0 0
               C10 -12,34 -14,42 3
               C48 18,34 26,14 16
               C6 12,3 6,0 0 Z" fill="${fill}"/>

      <!-- inner shading (paint stroke feel) -->
      <path d="M-34 7 C-28 1,-18 -1,-12 6
               C-20 10,-28 12,-34 7 Z" fill="${shade}" opacity="0.55"/>
      <path d="M34 7  C28 1,18 -1,12 6
               C20 10,28 12,34 7 Z" fill="${shade}" opacity="0.55"/>

      <!-- tails (soft long) -->
      <path d="M-6 14
               C-18 30,-26 52,-18 72
               C-8 64,-6 48,-1 22
               C-1 18,-3 15,-6 14 Z" fill="${fill}"/>
      <path d="M6 14
               C18 30,26 52,18 72
               C8 64,6 48,1 22
               C1 18,3 15,6 14 Z" fill="${fill}"/>

      <!-- tail shade -->
      <path d="M-18 44 C-16 54,-14 62,-10 68" stroke="${shade}" stroke-width="6" opacity="0.18" fill="none" stroke-linecap="round"/>
      <path d="M18 44  C16 54,14 62,10 68"  stroke="${shade}" stroke-width="6" opacity="0.18" fill="none" stroke-linecap="round"/>

      <!-- knot -->
      <path d="M-7 2
               C-10 6,-10 12,-7 16
               C-2 20,2 20,7 16
               C10 12,10 6,7 2
               C2 -2,-2 -2,-7 2 Z" fill="${knot}"/>

      <!-- highlights (hand-drawn) -->
      <path d="M-28 6 C-22 -2,-14 -4,-10 0" stroke="${hi}" stroke-width="3" opacity="0.55" fill="none" stroke-linecap="round"/>
      <path d="M28 6  C22 -2,14 -4,10 0"  stroke="${hi}" stroke-width="3" opacity="0.55" fill="none" stroke-linecap="round"/>
      <path d="M-10 22 C-14 34,-12 44,-8 54" stroke="${hi}" stroke-width="2.6" opacity="0.35" fill="none" stroke-linecap="round"/>
      <path d="M10 22  C14 34,12 44,8 54"  stroke="${hi}" stroke-width="2.6" opacity="0.35" fill="none" stroke-linecap="round"/>

      ${specklesSoft("#ffffff",0.10)}
    </g>
  `;
}

function bowSVG_WaterYellow(){
  return bowSVG_Sheer({ fill:"#fcd34d", shade:"#f59e0b", hi:"#fff7da", knot:"#fbbf24" });
}
function bowSVG_WaterGreen(){
  return bowSVG_Sheer({ fill:"#86efac", shade:"#22c55e", hi:"#f0fff4", knot:"#4ade80" });
}
function bowSVG_WaterRed(){
  return bowSVG_Sheer({ fill:"#fca5a5", shade:"#ef4444", hi:"#fff1f2", knot:"#fb7185" });
}


/**
 * Angelï¼ˆç²‰å½©æ‰‹ç¹ªé¢¨ï¼‰
 * âœ… ä¸è‡ªå¸¶ translate/scaleï¼›å¤–å±¤æ±ºå®šä½ç½®å¤§å°
 */
function bowSVG_StripesCandy({dress="#cfe7ff", wing="#f6f0ff", hair="#f7c77a", halo="#ffd66b", line="#2b2b2b"} = {}){
  return `
    <g>
      <!-- halo -->
      <ellipse cx="0" cy="-34" rx="14" ry="5.5" fill="${halo}" opacity="0.95"/>
      <path d="M-9 -34 C-4 -38,4 -38,9 -34" stroke="#fff7cf" stroke-width="2.4" opacity="0.55" fill="none" stroke-linecap="round"/>

      <!-- wings -->
      <path d="M-10 -10
               C-32 -18,-42 6,-28 18
               C-18 26,-8 20,-6 10
               C-5 4,-6 -4,-10 -10 Z" fill="${wing}"/>
      <path d="M10 -10
               C32 -18,42 6,28 18
               C18 26,8 20,6 10
               C5 4,6 -4,10 -10 Z" fill="${wing}"/>

      <!-- wing brush lines -->
      <path d="M-30 0 C-22 -6,-16 -2,-12 6" stroke="#ffffff" stroke-width="2.4" opacity="0.40" fill="none" stroke-linecap="round"/>
      <path d="M30 0  C22 -6,16 -2,12 6"  stroke="#ffffff" stroke-width="2.4" opacity="0.40" fill="none" stroke-linecap="round"/>

      <!-- head -->
      <circle cx="0" cy="-18" r="10.5" fill="#ffe7d6"/>
      <!-- hair -->
      <path d="M-10 -19
               C-8 -30,8 -30,10 -19
               C9 -9,6 -7,0 -6
               C-6 -7,-9 -9,-10 -19 Z" fill="${hair}" opacity="0.95"/>
      <path d="M-6 -18 C-8 -14,-7 -10,-4 -8" stroke="#fff2cc" stroke-width="2.6" opacity="0.35" fill="none" stroke-linecap="round"/>

      <!-- simple face -->
      <circle cx="-3.5" cy="-19" r="1.2" fill="${line}" opacity="0.55"/>
      <circle cx="3.5"  cy="-19" r="1.2" fill="${line}" opacity="0.55"/>
      <path d="M-2 -15 C-1 -13,1 -13,2 -15" stroke="${line}" stroke-width="1.8" opacity="0.35" fill="none" stroke-linecap="round"/>

      <!-- body dress -->
      <path d="M0 -6
               C-10 -2,-16 10,-14 26
               C-12 40,-6 48,0 50
               C6 48,12 40,14 26
               C16 10,10 -2,0 -6 Z" fill="${dress}"/>

      <!-- dress shading -->
      <path d="M-6 10 C-10 22,-8 34,-4 44" stroke="#ffffff" stroke-width="3.2" opacity="0.35" fill="none" stroke-linecap="round"/>
      <path d="M6 10  C10 22,8 34,4 44"  stroke="#5f8fc9" stroke-width="3.2" opacity="0.10" fill="none" stroke-linecap="round"/>

      <!-- tiny hands -->
      <circle cx="-8" cy="12" r="2.2" fill="#ffe7d6" opacity="0.95"/>
      <circle cx="8"  cy="12" r="2.2" fill="#ffe7d6" opacity="0.95"/>

      ${specklesSoft("#fff",0.08)}
    </g>
  `;
}

// âœ… æŠŠã€ŒåŸæœ¬èª¤æ”¾åœ¨è´è¶çµ(Candy)ã€çš„å¤©ä½¿åœ–ï¼ŒåŒ…æˆæ¨™æº– TreeTop å¤©ä½¿åº§æ¨™ç³»
// é€™æ¨£å®ƒåœ¨ã€Œå…¶ä»–(å¤©ä½¿)ã€åˆ†é¡èˆ‡æ¨¹æ¢¢é¡¯ç¤ºæ™‚ï¼Œéƒ½ä¸æœƒè·‘åˆ°è§’è½/è¢«åˆ‡ã€‚
function angelSVG_Candy(){
  return `
    <g transform="translate(260 120)">
      ${bowSVG_StripesCandy()}
    </g>
  `;
}

function angelSVG_SimpleGold(){
  return `
    <g transform="${STAR_T(1.08)}">
      <!-- wings -->
      <path d="M-10 6 C-30 2,-34 24,-16 28 C-10 30,-6 20,-8 12 Z" fill="#fff4cc" opacity="0.85"/>
      <path d="M10 6  C30 2,34 24,16 28  C10 30,6 20,8 12 Z"  fill="#fff4cc" opacity="0.85"/>

      <!-- body -->
      <path d="M0 2
               C-8 4,-14 14,-12 26
               C-10 38,-4 46,0 48
               C4 46,10 38,12 26
               C14 14,8 4,0 2 Z" fill="#fcd34d" opacity="0.95"/>
      <!-- head -->
      <circle cx="0" cy="-10" r="8.5" fill="#ffe7d6" opacity="0.95"/>

      <!-- halo -->
      <ellipse cx="0" cy="-22" rx="12" ry="4.2" fill="none" stroke="#fde68a" stroke-width="3" opacity="0.85"/>

      <!-- tiny sparkle -->
      <path d="M0 -36 L3 -30 L9 -28 L3 -26 L0 -20 L-3 -26 L-9 -28 L-3 -30 Z" fill="#fff" opacity="0.7"/>
      ${specklesSoft("#fff",0.10)}
    </g>`;
}

function angelSVG_SimpleBlue(){
  return `
    <g transform="${STAR_T(1.08)}">
      <!-- wings -->
      <path d="M-10 6 C-30 2,-34 24,-16 28 C-10 30,-6 20,-8 12 Z" fill="#e0f2fe" opacity="0.85"/>
      <path d="M10 6  C30 2,34 24,16 28  C10 30,6 20,8 12 Z"  fill="#e0f2fe" opacity="0.85"/>

      <!-- body -->
      <path d="M0 2
               C-8 4,-14 14,-12 26
               C-10 38,-4 46,0 48
               C4 46,10 38,12 26
               C14 14,8 4,0 2 Z" fill="#60a5fa" opacity="0.92"/>

      <!-- head -->
      <circle cx="0" cy="-10" r="8.5" fill="#ffe7d6" opacity="0.95"/>

      <!-- halo -->
      <ellipse cx="0" cy="-22" rx="12" ry="4.2" fill="none" stroke="#bae6fd" stroke-width="3" opacity="0.85"/>

      <!-- tiny sparkle -->
      <path d="M0 -36 L3 -30 L9 -28 L3 -26 L0 -20 L-3 -26 L-9 -28 L-3 -30 Z" fill="#fff" opacity="0.7"/>
      ${specklesSoft("#fff",0.10)}
    </g>`;
}
function xmasSVG_Holly(){
  return `
    <g transform="${STAR_T(1.05)}">
      <defs>
        <filter id="wcSoft">
          <feGaussianBlur stdDeviation="0.8"/>
        </filter>
      </defs>

      <!-- leaves -->
      <path d="M-20 10
               C-30 0,-18 -10,-6 -8
               C-10 -18,2 -22,8 -14
               C12 -22,24 -18,22 -8
               C34 -10,46 0,36 10
               C26 20,10 16,8 10
               C2 16,-14 20,-20 10 Z"
            fill="#7fcf9a" opacity="0.85"/>
      <path d="M-18 10
               C-26 2,-16 -6,-6 -5
               C-10 -14,0 -16,6 -11
               C10 -16,20 -14,18 -5
               C28 -6,38 2,30 10
               C22 16,12 14,8 10
               C2 14,-10 16,-18 10 Z"
            fill="#4bbf76" opacity="0.65" filter="url(#wcSoft)"/>

      <!-- berries -->
      <circle cx="-6" cy="8" r="5.5" fill="#ff6b6b" opacity="0.9"/>
      <circle cx="6"  cy="6" r="5.8" fill="#ef4444" opacity="0.9"/>
      <circle cx="1"  cy="14" r="5.2" fill="#f87171" opacity="0.88"/>

      <!-- soft highlights -->
      <circle cx="-7" cy="6" r="2.2" fill="rgba(255,255,255,.35)" filter="url(#wcSoft)"/>
      <circle cx="5"  cy="4" r="2.2" fill="rgba(255,255,255,.35)" filter="url(#wcSoft)"/>
    </g>`;
}

function xmasSVG_Bell(){
  return `
    <g transform="${STAR_T(1.05)}">

      <!-- bell body -->
      <path d="M0 -16
               C-10 -10,-18 2,-18 14
               C-18 22,-12 28,0 28
               C12 28,18 22,18 14
               C18 2,10 -10,0 -16 Z"
            fill="#fbbf24" opacity="0.92"/>
      <path d="M0 -14
               C-8 -9,-14 2,-14 13
               C-14 19,-10 24,0 24
               C10 24,14 19,14 13
               C14 2,8 -9,0 -14 Z"
            fill="#fde68a" opacity="0.55"/>

      <!-- top cap -->
      <rect x="-10" y="-22" width="20" height="10" rx="5"
            fill="#d97706" opacity="0.9"/>
      <circle cx="0" cy="-24" r="4.5" fill="#fcd34d" opacity="0.9"/>

      <!-- clapper -->
      <circle cx="0" cy="20" r="4.2" fill="#92400e" opacity="0.85"/>
    </g>`;
}

function xmasSVG_SantaHat(){
  return `
    <g transform="${STAR_T(1.05)}">

      <!-- hat red -->
      <path d="M-22 18
               C-10 -6, 18 -16, 26 4
               C18 8, 12 14, 4 18
               C-4 22, -12 22, -22 18 Z"
            fill="#ef4444" opacity="0.9"/>
      <path d="M-18 16
               C-8 0, 14 -8, 20 6
               C14 8, 10 12, 3 15
               C-4 18, -10 18, -18 16 Z"
            fill="#fca5a5" opacity="0.45"/>

      <!-- brim -->
      <path d="M-26 18
               C-16 30, 16 30, 28 18
               C18 10, -16 10, -26 18 Z"
            fill="#fff" opacity="0.92"/>

      <!-- pom -->
      <circle cx="28" cy="6" r="8" fill="#fff" opacity="0.92"/>
    </g>`;
}

function xmasSVG_CandyCane(){
  return `
    <g transform="${STAR_T(1.05)}">

      <!-- base cane -->
      <path d="M8 -22
               C22 -22, 22 -4, 10 -4
               L10 22
               C10 30, -2 30, -2 22
               L-2 -4
               C-2 -16, 0 -22, 8 -22 Z"
            fill="#fff" opacity="0.95"/>

      <!-- red stripes -->
      <path d="M5 -20 C14 -20, 14 -10, 6 -10" fill="none" stroke="#ef4444" stroke-width="6" stroke-linecap="round" opacity="0.9"/>
      <path d="M1 -6  L10 2"  fill="none" stroke="#ef4444" stroke-width="6" stroke-linecap="round" opacity="0.9"/>
      <path d="M1 8   L10 16" fill="none" stroke="#ef4444" stroke-width="6" stroke-linecap="round" opacity="0.9"/>
      <path d="M1 22  L8 28"  fill="none" stroke="#ef4444" stroke-width="6" stroke-linecap="round" opacity="0.9"/>

      <!-- soften edges -->
      <path d="M8 -22
               C22 -22, 22 -4, 10 -4
               L10 22
               C10 30, -2 30, -2 22
               L-2 -4
               C-2 -16, 0 -22, 8 -22 Z"
            fill="#fff" opacity="0.25"/>
    </g>`;
}

function xmasSVG_Gift(){
  return `
    <g transform="${STAR_T(1.05)}">
      <!-- box -->
      <rect x="-18" y="2" width="36" height="28" rx="6" fill="#60a5fa" opacity="0.90"/>
      <rect x="-18" y="2" width="36" height="28" rx="6" fill="#bfdbfe" opacity="0.35"/>

      <!-- ribbon -->
      <rect x="-4" y="2" width="8" height="28" rx="3" fill="#ef4444" opacity="0.90"/>
      <rect x="-18" y="12" width="36" height="8" rx="3" fill="#f87171" opacity="0.90"/>

      <!-- lid -->
      <rect x="-19" y="-4" width="38" height="10" rx="6" fill="#93c5fd" opacity="0.85"/>
      <rect x="-4" y="-4" width="8" height="10" rx="3" fill="#ef4444" opacity="0.90"/>

      <!-- bow -->
      <path d="M0 -2
               C-8 -12,-20 -10,-18 -2
               C-16 6,-6 6,0 -2 Z"
            fill="#ef4444" opacity="0.90"/>
      <path d="M0 -2
               C8 -12,20 -10,18 -2
               C16 6,6 6,0 -2 Z"
            fill="#ef4444" opacity="0.90"/>
      <circle cx="0" cy="0" r="5" fill="#fca5a5" opacity="0.65"/>
    </g>`;
}


function bowSVG_LineArt({fill="#f59e0b"} = {}){
  return `
    <g opacity="0.95">
      <!-- outline loops -->
      <path d="M0 2
               C-10 -10,-30 -12,-36 2
               C-40 12,-32 18,-16 14
               C-8 12,-4 6,0 2 Z"
            fill="none" stroke="${fill}" stroke-width="4" stroke-linejoin="round" stroke-linecap="round"/>
      <path d="M0 2
               C10 -10,30 -12,36 2
               C40 12,32 18,16 14
               C8 12,4 6,0 2 Z"
            fill="none" stroke="${fill}" stroke-width="4" stroke-linejoin="round" stroke-linecap="round"/>

      <!-- tails -->
      <path d="M-4 14 C-14 28,-16 46,-8 62" fill="none" stroke="${fill}" stroke-width="4" stroke-linecap="round"/>
      <path d="M4 14  C14 28,16 46,8 62"  fill="none" stroke="${fill}" stroke-width="4" stroke-linecap="round"/>

      <!-- knot -->
      <circle cx="0" cy="8" r="6.2" fill="none" stroke="${fill}" stroke-width="4"/>

      <!-- tiny sparkle -->
      <path d="M-14 8 L-8 8" stroke="#fff" stroke-width="2.2" opacity="0.25" stroke-linecap="round"/>
      <path d="M14 8  L8 8"  stroke="#fff" stroke-width="2.2" opacity="0.25" stroke-linecap="round"/>
    </g>
  `;
}


  </script>
</body>
</html>